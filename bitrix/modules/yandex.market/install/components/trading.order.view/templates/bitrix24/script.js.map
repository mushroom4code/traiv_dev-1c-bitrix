{"version":3,"file":"script.js","sources":["src/factory.js","src/utils.js","src/reference/field.js","src/basket/summaryskeleton.js","src/basket/cis.js","src/basket/digital.js","src/bracketchain.js","src/basket/itemview.js","src/basket/itemedit.js","src/basket/basket.js","src/box/itemview.js","src/box/basketitemmovemodal.js","src/box/basketitemsplitmodal.js","src/box/boxonlypartdeletemodal.js","src/box/itemedit.js","src/box/collection.js","src/box/field.js","src/basketconfirm/field.js","src/property/field.js","src/print/field.js","src/notification/field.js","src/index.js","src/compatible/editor.js"],"sourcesContent":["const BX = window.BX;\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tname: 'yamarket',\r\n\t\tmap: {},\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tregister() {\r\n\t\tif (this.isEditorInitialized()) {\r\n\t\t\tthis.registerEditorMethod();\r\n\t\t} else {\r\n\t\t\tthis.handleEditorInit(true);\r\n\t\t}\r\n\t}\r\n\r\n\tisEditorInitialized() {\r\n\t\treturn BX.UI?.EntityEditorControlFactory?.initialized;\r\n\t}\r\n\r\n\tregisterEditorMethod() {\r\n\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod(this.options.name, this.build);\r\n\t}\r\n\r\n\thandleEditorInit(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorControlFactory:onInitialize', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (factory, event) => {\r\n\t\tevent.methods[this.options.name] = this.build;\r\n\t\tthis.handleEditorInit(false);\r\n\t}\r\n\r\n\tbuild = (type, controlId, settings) => {\r\n\t\tconst prefix = this.options.name + '_';\r\n\r\n\t\tif (type.indexOf(prefix) !== 0) { return null; }\r\n\r\n\t\tconst internalType = type.substr(prefix.length);\r\n\r\n\t\tif (!this.options.map.hasOwnProperty(internalType)) { return null; }\r\n\r\n\t\tconst fieldClass = this.options.map[internalType];\r\n\r\n\t\treturn fieldClass.create(controlId, settings);\r\n\t}\r\n}","export function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}\r\n\r\nexport function pascalCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word) => word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function camelCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) => index === 0 ? word.toLowerCase() : word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function kebabCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) =>  word.toLowerCase())\r\n\t\t.join('-');\r\n}\r\n\r\nexport function copyValues(from, to) {\r\n\tconst fromValues = collectValues(from);\r\n\r\n\treturn fillValues(to, fromValues);\r\n}\r\n\r\nexport function collectValues(container) {\r\n\tconst inputs = findInputs(container);\r\n\tconst result = {};\r\n\r\n\tfor (const [name, input] of Object.entries(inputs)) {\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tif (!option.selected) { continue; }\r\n\r\n\t\t\t\tresult[name] = option.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult[name] = input.value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function fillValues(container, values) {\r\n\tconst inputs = findInputs(container);\r\n\tlet isChanged = false;\r\n\r\n\tfor (const [name, value] of Object.entries(values)) {\r\n\t\tif (inputs[name] == null) { continue; }\r\n\r\n\t\tconst input = inputs[name];\r\n\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tconst selected = (option.value === value);\r\n\r\n\t\t\t\tif (selected === Boolean(option.selected)) { continue; }\r\n\r\n\t\t\t\toption.selected = selected;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (input.value === value) { continue; }\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\tinput.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn isChanged;\r\n}\r\n\r\nexport function findInputs(container) {\r\n\tconst inputs = container.querySelectorAll('input, select, textarea');\r\n\tconst result = {};\r\n\r\n\tfor (const input of inputs) {\r\n\t\tif (!input.name) { continue; }\r\n\r\n\t\tresult[input.name] = input;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function replaceTemplateVariables(template, variables) {\r\n\tlet result = template;\r\n\r\n\tif (variables == null) { return result; }\r\n\r\n\tfor (const [key, value] of Object.entries(variables)) {\r\n\t\tresult = result.replace('#' + key + '#', value);\r\n\t}\r\n\r\n\treturn result;\r\n}","import {replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Field extends BX.UI.EntityEditorField {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._hasLayout = false;\r\n\t\tthis.options = this.constructor.defaults != null\r\n\t\t\t? Object.assign({}, this.constructor.defaults)\r\n\t\t\t: {};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.constructor.messages[key] || super.getMessage(key);\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tclearLayout() {\r\n\t\tif (!this._hasLayout) { return; }\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\t\tthis._hasLayout = false;\r\n\t}\r\n\r\n\tlayout(options) {\r\n\t\tif (this._hasLayout) { return; }\r\n\r\n\t\tthis.ensureWrapperCreated({});\r\n\t\tthis.adjustWrapper();\r\n\r\n\t\tif (!this.isNeedToDisplay()) {\r\n\t\t\tthis.registerLayout(options);\r\n\t\t\tthis._hasLayout = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\r\n\t\t}\r\n\r\n\t\tif (this.useTitle()) {\r\n\t\t\tconst title = this.getTitle();\r\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\r\n\t\t}\r\n\r\n\t\tthis.render(this.getValue());\r\n\r\n\t\tif (this.isContextMenuEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\r\n\t\t}\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis.initializeDragDropAbilities();\r\n\t\t}\r\n\r\n\t\tthis.registerLayout(options);\r\n\t\tthis._hasLayout = true;\r\n\t}\r\n\r\n\tforget() {}\r\n\r\n\trender(payload) {}\r\n\r\n\tuseTitle() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelectorAll(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelectorAll(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelector(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelector(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n}","import {copyValues, replaceTemplateVariables} from \"../utils\";\r\nimport './summary.css';\r\n\r\nexport default class SummarySkeleton {\r\n\r\n\tstatic STATUS_READY = 'READY';\r\n\tstatic STATUS_WAIT = 'WAIT';\r\n\tstatic STATUS_EMPTY = 'EMPTY';\r\n\r\n\tstatic defaults = {\r\n\t\tmodalElement: '.yamarket-item-summary__modal',\r\n\t\tstatusElement: '.yamarket-item-summary__status',\r\n\t\tinputElement: 'input',\r\n\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t};\r\n\r\n\tel;\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tclone() : SummarySkeleton {\r\n\t\treturn new this.constructor(this.options);\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleStatusClick(true);\r\n\t}\r\n\r\n\thandleStatusClick(dir) {\r\n\t\tconst status = this.getElement('status');\r\n\r\n\t\tif (status == null) { return; }\r\n\r\n\t\tstatus[dir ? 'addEventListener' : 'removeEventListener']('click', this.onStatusClick);\r\n\t}\r\n\r\n\tonStatusClick = (evt) => {\r\n\t\tthis.openDialog();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tsetup(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\treplaceName(oldName: string, newName: string) : void {\r\n\t\tthis.options.name = this.options.name.replace(oldName, newName);\r\n\t}\r\n\r\n\tbuild() {\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildStatus() {\r\n\t\tconst cises = this.optionValue();\r\n\t\tconst status = this.getStatus(cises);\r\n\r\n\t\treturn `<a class=\"yamarket-item-summary__status\" href=\"#\" data-status=\"${status}\">${this.getMessage('SUMMARY_' + status)}</a>`\r\n\t}\r\n\r\n\treflowStatus() {\r\n\t\tconst value = this.formValue();\r\n\t\tconst status = this.getStatus(value);\r\n\t\tconst element = this.getElement('status');\r\n\r\n\t\telement.setAttribute('data-status', status);\r\n\t\telement.textContent = this.getMessage('SUMMARY_' + status);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {any} value\r\n\t *\r\n\t * @return {string}\r\n\t */\r\n\tgetStatus(value) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {string} */\r\n\tbuildForm(useFormValue = false) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\treflowForm() {\r\n\t\tconst modal = this.el.querySelector('.yamarket-item-summary__modal');\r\n\r\n\t\tmodal.innerHTML = this.buildForm(true);\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\toptionValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\tformValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\topenDialog() {\r\n\t\tconst modal = this.getElement('modal').firstElementChild;\r\n\t\tconst options  = this.dialogOptions();\r\n\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\tmessageBox.setMessage(modal.cloneNode(true));\r\n\t\tmessageBox.setButtons([\r\n\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t]);\r\n\r\n\t\tmessageBox.show();\r\n\t\tcopyValues(this.el, messageBox.popupWindow.contentContainer);\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tonSaveClick(messageBox) {\r\n\t\tconst isChanged = copyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\r\n\t\tif (isChanged && this.options.onChange) {\r\n\t\t\tthis.options.onChange();\r\n\t\t}\r\n\r\n\t\tthis.reflowStatus();\r\n\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tonCancelClick(messageBox) {\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.options.messages[key] || key;\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelectorAll(selector);\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelector(selector);\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {fillValues, replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Cis extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\tcopyElement: '.yamarket-item-summary__copy',\r\n\t\tinputElement: 'input, select',\r\n\t\ttitle: '',\r\n\t\toffset: 0,\r\n\t\tcount: 0,\r\n\t\ttotal: 0,\r\n\t\tmarkingGroup: false,\r\n\t\tmarkingType: null,\r\n\t\tinstances: [],\r\n\t\tinstanceTypes: [],\r\n\t\tinternalInstances: [],\r\n\t})\r\n\r\n\tbind() {\r\n\t\tsuper.bind();\r\n\t\tthis.handleCopyClick(true);\r\n\t}\r\n\r\n\thandleCopyClick(dir) {\r\n\t\tconst copy = this.getElement('copy');\r\n\r\n\t\tif (copy == null) { return; }\r\n\r\n\t\tcopy[dir ? 'addEventListener' : 'removeEventListener']('click', this.onCopyClick);\r\n\t}\r\n\r\n\tonCopyClick = (evt) => {\r\n\t\tthis.copyInternal();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.count = count;\r\n\t\tthis.reflowForm();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tupdateCount(count, offset) {\r\n\t\tthis.options.count = count;\r\n\t\tthis.options.offset = offset;\r\n\t\tthis.reflowForm();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tif (this.requiredTypes().length === 0) { return '&mdash;'; }\r\n\r\n\t\tconst internalCises = this.optionValue('internal');\r\n\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.emptyValues(internalCises) ? '' : this.buildCopyIcon()}\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildCopyIcon() {\r\n\t\treturn `<button class=\"yamarket-item-summary__copy\" type=\"button\" title=\"${this.getMessage('COPY')}\">\r\n\t\t\t${this.getMessage('COPY')}\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\t\tconst value = useFormValue ? this.formValue(true) : this.optionValue();\r\n\t\tconst types = this.requiredTypes();\r\n\r\n\t\treturn `<table class=\"ui-form yamarket-cis-table\">\r\n\t\t\t<thead class=\"yamarket-cis-table__head\">\r\n\t\t\t\t<td></td>\r\n\t\t\t\t${types.map((type) => `<td>${this.getMessage('HEAD_' + type)}</td>`).join('')}\r\n\t\t\t</thead>\r\n\t\t\t\r\n\t\t\t${iterator.map((dummy, index) => {\r\n\t\t\t\tconst hidden = (index < this.options.offset || index >= this.options.count + this.options.offset);\r\n\t\t\t\t\r\n\t\t\t\treturn `<tr ${hidden ? 'hidden' : ''}>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__number\">\r\n\t\t\t\t\t\t&numero;${index + 1}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t${types.map((type) => {\r\n\t\t\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\t\t\tconst one = value[name] ?? '';\r\n\t\t\t\t\t\tconst placeholder = this.hasMessage('PLACEHOLDER_' + type) ? this.getMessage('PLACEHOLDER_' + type) : '';\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn `\r\n\t\t\t\t\t\t\t<td class=\"yamarket-cis-table__control type-count--${types.length}\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.inputName(name)}\" value=\"${BX.util.htmlspecialchars(one)}\" data-name=\"${name}\" placeholder=\"${placeholder}\" ${hidden ? 'disabled' : ''} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t`;\r\n\t\t\t\t\t}).join('')}\r\n\t\t\t\t</tr>`;\r\n\t\t\t}).join('')}\r\n\t\t\t${types.includes('CIS') && this.fixedCisType() == null ? \r\n\t\t\t\t`<tr>\r\n\t\t\t\t\t<td></td>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__type\">\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-label\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('FORMAT')}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-value\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"${this.inputName('TYPE')}\" data-name=\"TYPE\">\r\n\t\t\t\t\t\t\t\t\t${['CIS', 'UIN'].map((typeVariant) => {\r\n\t\t\t\t\t\t\t\t\t\treturn `<option value=\"${typeVariant}\" ${typeVariant === value['TYPE'] ? 'selected' : ''}>${this.getMessage(typeVariant)}</option>`;\r\n\t\t\t\t\t\t\t\t\t}).join('')}\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>`\r\n\t\t\t : ''}\r\n\t\t</table>`;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tlet result;\r\n\r\n\t\tif (this.filledCount(value) >= this.options.count) {\r\n\t\t\tresult = SummarySkeleton.STATUS_READY;\r\n\t\t} else {\r\n\t\t\tresult = SummarySkeleton.STATUS_WAIT;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\temptyValues(values) {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tlet empty = true;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tempty = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!empty) { break; }\r\n\t\t}\r\n\r\n\t\treturn empty;\r\n\t}\r\n\r\n\tfilledCount(values) {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tlet filled = 0;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tlet itemFilled = true;\r\n\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value === '') {\r\n\t\t\t\t\titemFilled = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (itemFilled) {\r\n\t\t\t\t++filled;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn filled;\r\n\t}\r\n\r\n\tcopyInternal(container = this.el) {\r\n\t\tconst values = Object.assign({}, this.formValue(true), this.optionValue('internal'));\r\n\r\n\t\tif (!this.setValues(values, container)) { return; }\r\n\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tgetValues() : Object {\r\n\t\treturn this.formValue();\r\n\t}\r\n\r\n\tsetValues(values: Object, container = this.el) : boolean {\r\n\t\treturn fillValues(container, this.makeInputValues(values))\r\n\t}\r\n\r\n\tmakeInputValues(values) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const [key, value] of Object.entries(values)) {\r\n\t\t\tresult[this.inputName(key)] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tinputName(selfName: string) : string {\r\n\t\tconst bracketPosition = selfName.indexOf('[');\r\n\t\tlet result;\r\n\r\n\t\tif (bracketPosition > 0) {\r\n\t\t\tresult =\r\n\t\t\t\tthis.options.name\r\n\t\t\t\t+ `[${selfName.substring(0, bracketPosition)}]`\r\n\t\t\t\t+ `${selfName.substring(bracketPosition)}`\r\n\t\t} else {\r\n\t\t\tresult = this.options.name + `[${selfName}]`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tformValue(needAll: boolean = false) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const input of this.fewElements('input')) {\r\n\t\t\tif (!needAll && input.disabled) { continue; }\r\n\r\n\t\t\tconst name = String(input.dataset.name).trim();\r\n\t\t\tconst value = input.value.trim();\r\n\r\n\t\t\tif (name === '') { continue; }\r\n\r\n\t\t\tresult[name] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue(optionKey = null) {\r\n\t\tconst instances = optionKey != null ? this.options[optionKey + 'Instances'] : this.options.instances;\r\n\t\tconst types = this.requiredTypes();\r\n\t\tconst result = {};\r\n\t\tconst fixedType = this.fixedCisType();\r\n\t\tconst cisTypes = this.cisTypes();\r\n\t\tlet index = 0;\r\n\r\n\t\tif (!Array.isArray(instances)) { return result; }\r\n\r\n\t\tfor (const instance of instances) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tlet value = (instance[type] ?? '').trim();\r\n\t\t\t\tlet valueType = type;\r\n\r\n\t\t\t\tif (value === '' && type === 'CIS' && fixedType == null) {\r\n\t\t\t\t\tvalue = (instance['UIN'] ?? '').trim();\r\n\t\t\t\t\tvalueType = 'UIN';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tresult[`ITEMS[${index}][${type}]`] = value;\r\n\r\n\t\t\t\t\tif (cisTypes.includes(valueType)) {\r\n\t\t\t\t\t\tresult['TYPE'] = valueType;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tif (fixedType == null && result['TYPE'] == null && this.options.markingType != null) {\r\n\t\t\tresult['TYPE'] = this.options.markingType;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcisTypes() {\r\n\t\treturn [ 'UIN', 'CIS' ];\r\n\t}\r\n\r\n\tfixedCisType() {\r\n\t\tconst option = (this.options.instanceTypes || []);\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (option.includes(type)) {\r\n\t\t\t\treturn type;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\trequiredTypes() : Array {\r\n\t\tconst result = (this.options.instanceTypes || []).slice();\r\n\t\tlet foundCis = false;\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (result.includes(type)) {\r\n\t\t\t\tfoundCis = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!foundCis && this.options.markingGroup) {\r\n\t\t\tresult.unshift('CIS');\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.options.title,\r\n\t\t\tminWidth: Math.max(400, Math.min(1200, this.requiredTypes().length * 400))\r\n\t\t};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_CIS_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n\r\n\thasMessage(key) {\r\n\t\treturn this.getMessage(key) !== key;\r\n\t}\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {collectValues, replaceTemplateVariables} from \"../utils\";\r\nimport {BracketChain} from \"../bracketchain\";\r\n\r\nexport default class Digital extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\titems: [],\r\n\t\ttotal: 0,\r\n\t})\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst formValue = useFormValue ? this.formValue() : this.optionValue();\r\n\r\n\t\treturn `<div class=\"ui-form\">\r\n\t\t\t${this.buildFormCodes(total, formValue)}\r\n\t\t\t${this.buildFormAdditional(total, formValue)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildFormCodes(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\r\n\t\treturn iterator.map((dummy, index) => {\r\n\t\t\tconst oneValue = formValue?.ITEM?.[index] || {};\r\n\r\n\t\t\tlet title = '';\r\n\t\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('CODE')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][CODE]\" value=\"${BX.util.htmlspecialchars(oneValue['CODE'] || '')}\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ACTIVATE_TILL')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w100\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][ACTIVATE_TILL]\" value=\"${BX.util.htmlspecialchars(oneValue['ACTIVATE_TILL'] || '')}\" onclick=\"BX.calendar({node: this, field: this, bTime: false, bHideTime: true})\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\r\n\t\t\tif (hasFew) {\r\n\t\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('GROUP', { 'NUMBER': index + 1 })}</div>`;\r\n\t\t\t}\r\n\r\n\t\t\treturn title + fieldset;\r\n\t\t}).join('');\r\n\t}\r\n\r\n\tbuildFormAdditional(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tlet title = '';\r\n\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('SLIP')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<textarea class=\"ui-entity-editor-field-textarea\" name=\"${this.options.name}[SLIP]\" rows=\"5\" required>${BX.util.htmlspecialchars(formValue['SLIP'] || '')}</textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\r\n\t\tif (hasFew) {\r\n\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('ADDITIONAL')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn title + fieldset;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tconst filledItems = this.filterFilledItems(value.ITEM);\r\n\t\tconst isItemsFilled = filledItems.length >= this.options.total;\r\n\t\tconst isSlipFilled = (value['SLIP'] != null && value['SLIP'].trim() !== '');\r\n\r\n\t\treturn (\r\n\t\t\tisItemsFilled && isSlipFilled\r\n\t\t\t\t? SummarySkeleton.STATUS_READY\r\n\t\t\t\t: SummarySkeleton.STATUS_WAIT\r\n\t\t);\r\n\t}\r\n\r\n\tfilterFilledItems(items) {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['CODE'] == null || item['CODE'].trim() === '') { continue; }\r\n\t\t\tif (item['ACTIVATE_TILL'] == null || item['ACTIVATE_TILL'].trim() === '') { continue; }\r\n\r\n\t\t\tresult.push(item);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue() {\r\n\t\tconst items = Array.isArray(this.options.items) ? this.options.items : [];\r\n\t\tlet slip = '';\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['SLIP'] != null && item['SLIP'] !== '') {\r\n\t\t\t\tslip = item['SLIP'];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t'ITEM': items,\r\n\t\t\t'SLIP': slip,\r\n\t\t};\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst rawValues = collectValues(this.el);\r\n\t\tconst values = BracketChain.toTree(rawValues, this.options.name);\r\n\t\tconst defaults = {\r\n\t\t\t'ITEM': [],\r\n\t\t\t'SLIP': '',\r\n\t\t};\r\n\r\n\t\treturn Object.assign(defaults, values);\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_DIGITAL_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n}","export class BracketChain {\r\n\r\n\tstatic toTree(values, base = null) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const key in values) {\r\n\t\t\tif (!values.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tconst keyRelative = this.keyRelative(key, base);\r\n\r\n\t\t\tif (keyRelative == null) { continue; }\r\n\r\n\t\t\tconst keyChain = this.valueKeyChain(keyRelative);\r\n\r\n\t\t\tthis.setValueByKeyChain(result, keyChain, values[key]);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic keyRelative(key, base) {\r\n\t\tif (base == null) { return key; }\r\n\t\tif (key.indexOf(base) !== 0) { return null; }\r\n\r\n\t\treturn key.replace(base, '');\r\n\t}\r\n\r\n\tstatic valueKeyChain(key) {\r\n\t\tconst parts = key.split('[');\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const part of parts) {\r\n\t\t\tif (part === '' && result.length === 0) { continue; }\r\n\r\n\t\t\tconst name = part.replace(/]$/, '');\r\n\r\n\t\t\tresult.push(name);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic setValueByKeyChain(result, chain, value) {\r\n\t\tconst lastKey = chain.pop();\r\n\t\tlet level = result;\r\n\r\n\t\tfor (let index = 0; index < chain.length; ++index) {\r\n\t\t\tconst key = chain[index];\r\n\t\t\tconst nextKey = (index + 1 === chain.length) ? lastKey : chain[index + 1];\r\n\r\n\t\t\tif (level[key] == null) {\r\n\t\t\t\tlevel[key] = /^\\d+$/.test(nextKey) ? [] : {};\r\n\t\t\t}\r\n\r\n\t\t\tlevel = level[key];\r\n\t\t}\r\n\r\n\t\tlevel[lastKey] = value;\r\n\t}\r\n\r\n}","import Cis from \"./cis\";\r\nimport Digital from \"./digital\";\r\nimport {htmlToElement, pascalCase, kebabCase, findInputs} from \"../utils\";\r\nimport type SummarySkeleton from \"./summaryskeleton\";\r\n\r\nexport default class ItemView {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tname: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tel;\r\n\r\n\tconstructor(options: Object) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._wires = [];\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tthis.forgetWires();\r\n\t\tthis.options = {};\r\n\t}\r\n\r\n\tclone() : ItemView {\r\n\t\tconst cloned = new this.constructor(this.options);\r\n\t\tcloned.el = this.el.cloneNode(true);\r\n\r\n\t\tfor (const [key, wire] of Object.entries(this._wires)) {\r\n\t\t\tcloned.wire(key, wire.clone());\r\n\t\t}\r\n\r\n\t\tcloned.setupWires();\r\n\t\tcloned.bind();\r\n\r\n\t\treturn cloned;\r\n\t}\r\n\r\n\tbind() : void {}\r\n\r\n\tunbind() : void {}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tgetTitle() : string {\r\n\t\treturn this.el.querySelector('[data-entity=\"NAME\"]').textContent.trim();\r\n\t}\r\n\r\n\tid() : string {\r\n\t\treturn this.getInputValue('ID');\r\n\t}\r\n\r\n\trender(item: Object, basket: Object) : void {\r\n\t\tconst columns = Object.keys(basket.COLUMNS);\r\n\t\tconst basketItem = basket.ITEMS[item.BASKET_KEY];\r\n\r\n\t\tcolumns.unshift('INDEX');\r\n\r\n\t\tthis.forgetWires();\r\n\r\n\t\tthis.el = htmlToElement(`<tr class=\"${item?.PARTIAL_COUNT?.CURRENT > 0 ? 'is--partial' : ''}\">\r\n\t\t\t${columns.map((key) => this.renderColumn(item, basketItem, key)).join('')}\r\n\t\t\t${this.renderActions()}\r\n\t\t</tr>`, 'tbody');\r\n\r\n\t\tthis.setupWires();\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tmount(point: HTMLElement) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n\r\n\treplaceName(newName: string) : void {\r\n\t\tconst oldName = this.options.name;\r\n\r\n\t\tfor (const [name, input] of Object.entries(findInputs(this.el))) {\r\n\t\t\tinput.name = name.replace(oldName, newName);\r\n\t\t}\r\n\r\n\t\tfor (const [, wire] of Object.entries(this._wires)) {\r\n\t\t\twire.replaceName(oldName, newName);\r\n\t\t}\r\n\r\n\t\tthis.options.name = newName;\r\n\t}\r\n\r\n\trenderColumn(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst method = 'column' + pascalCase(column);\r\n\r\n\t\treturn (\r\n\t\t\tmethod in this\r\n\t\t\t\t? this[method](item, basketItem, column)\r\n\t\t\t\t: this.columnDefault(item, basketItem, column)\r\n\t\t);\r\n\t}\r\n\r\n\tenableUp(enable: boolean = true) : void {}\r\n\r\n\tenableDown(enable: boolean = true) : void {}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnIndex(item: Object, basketItem: Object, column: string) : string {\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t${this.indexHidden(item, basketItem)}\r\n\t\t\t${this.valueFormatted(item, basketItem, column)}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tindexHidden(item: Object, basketItem: Object) : string {\r\n\t\tconst identifiersCount = this.value(item, basketItem, 'IDENTIFIERS_INITIAL_COUNT');\r\n\r\n\t\treturn ([\r\n\t\t\t`<input type=\"hidden\" name=\"${this.getName('ID')}\" value=\"${this.value(item, basketItem, 'ID')}\" />`,\r\n\t\t\t`<input type=\"hidden\" name=\"${this.getName('INITIAL_BOX')}\" value=\"${this.value(item, basketItem, 'INITIAL_BOX')}\" />`,\r\n\t\t\tidentifiersCount > 0\r\n\t\t\t\t? `<input type=\"hidden\" name=\"${this.getName('IDENTIFIERS')}[INITIAL_COUNT]\" value=\"${identifiersCount}\" />`\r\n\t\t\t\t: '',\r\n\t\t]).join('');\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnCis(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst cis = new Cis({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('IDENTIFIERS'),\r\n\t\t\ttitle: this.basketValue(basketItem, 'NAME'),\r\n\t\t\tmarkingType: this.basketValue(basketItem, 'MARKING_TYPE'),\r\n\t\t\tmarkingGroup: !!this.basketValue(basketItem, 'MARKING_GROUP'),\r\n\t\t\tinstanceTypes: this.basketValue(basketItem, 'INSTANCE_TYPES'),\r\n\t\t\tcount: +this.value(item, basketItem, 'COUNT'),\r\n\t\t\toffset: +this.value(item, basketItem, 'OFFSET'),\r\n\t\t\ttotal: +this.basketValue(basketItem, 'COUNT'),\r\n\t\t\tinstances: this.basketValue(basketItem, 'INSTANCES'),\r\n\t\t\tinternalInstances: this.basketValue(basketItem, 'INTERNAL_INSTANCES'),\r\n\t\t\tonChange: () => {\r\n\t\t\t\tthis.fire('cisUpdate');\r\n\t\t\t\tthis.options.onChange();\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.wire(column, cis);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-wire=\"${column}\">${cis.build()}</td>`;\r\n\t}\r\n\r\n\tcis() : ?Cis {\r\n\t\treturn this._wires['CIS'];\r\n\t}\r\n\r\n\tupdateCisCount() : void {\r\n\t\tthis.cis()?.updateCount(this.getCount(), this.getOffset());\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnDigital(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst digital = new Digital({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('DIGITAL'),\r\n\t\t\ttotal: this.value(item, basketItem, 'COUNT'),\r\n\t\t\titems: this.value(item, basketItem, 'DIGITAL'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(column, digital);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-wire=\"${column}\">${digital.build()}</td>`;\r\n\t}\r\n\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\tcolumnSubsidy(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst promos = this.value(item, basketItem, 'PROMOS');\r\n\t\tlet content = this.valueFormatted(item, basketItem, column);\r\n\r\n\t\tif (promos != null && Array.isArray(promos)) {\r\n\t\t\tcontent += promos.map((promo) => `<div>${promo}</div>`).join('');\r\n\t\t}\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">${content}</td>`;\r\n\t}\r\n\r\n\tcolumnCount(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst value = this.value(item, basketItem, column);\r\n\t\tconst valueSanitized = parseInt(value) || '';\r\n\t\tconst offset = parseInt(this.value(item, basketItem, 'OFFSET')) || 0;\r\n\t\tconst partialCurrent = item?.PARTIAL_COUNT?.CURRENT;\r\n\t\tconst partialTotal = item?.PARTIAL_COUNT?.TOTAL;\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('OFFSET')}\" value=\"${offset}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_CURRENT')}\" value=\"${partialCurrent || ''}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_TOTAL')}\" value=\"${partialTotal || ''}\" />\r\n\t\t\t<span data-entity=\"COUNT_TEXT\">${this.valueFormatted(item, basketItem, column)} ${this.getMessage('ITEM_UNIT')}</span>\r\n\t\t\t<span data-entity=\"PARTIAL_TEXT\">${this.partialText(partialCurrent, partialTotal)}</span>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tsetCount(count: number) : void {\r\n\t\tconst input = this.getInput('COUNT');\r\n\t\tconst text = this.el.querySelector('[data-entity=\"COUNT_TEXT\"]');\r\n\r\n\t\tinput.value = count;\r\n\t\ttext.textContent = `${count} ${this.getMessage('ITEM_UNIT')}`;\r\n\t}\r\n\r\n\tgetCount() : number {\r\n\t\treturn parseInt(this.getInputValue('COUNT')) || 0;\r\n\t}\r\n\r\n\tsetInitialCount(count: number) : void {\r\n\t\tthis.getInput('INITIAL_COUNT').value = count;\r\n\t}\r\n\r\n\tgetInitialCount() : number {\r\n\t\treturn parseInt(this.getInputValue('INITIAL_COUNT')) || 0;\r\n\t}\r\n\r\n\tsetOffset(offset: number) : void {\r\n\t\tthis.getInput('OFFSET').value = offset;\r\n\t}\r\n\r\n\tgetOffset() : number {\r\n\t\treturn parseInt(this.getInputValue('OFFSET')) || 0;\r\n\t}\r\n\r\n\tresetPart() : void {\r\n\t\tthis.el.classList.remove('is--partial');\r\n\t\tthis.getInput('PARTIAL_CURRENT').value = '';\r\n\t\tthis.getInput('PARTIAL_TOTAL').value = '';\r\n\t\tthis.el.querySelector('[data-entity=\"PARTIAL_TEXT\"]').textContent = '';\r\n\t}\r\n\r\n\tsetPart(index: number, total: number) : void {\r\n\t\tthis.el.classList.add('is--partial');\r\n\t\tthis.getInput('PARTIAL_CURRENT').value = index + 1;\r\n\t\tthis.getInput('PARTIAL_TOTAL').value = total;\r\n\t\tthis.el.querySelector('[data-entity=\"PARTIAL_TEXT\"]').textContent = this.partialText(+index + 1, total);\r\n\t}\r\n\r\n\tpartialText(current: number, total: number) : string {\r\n\t\treturn (\r\n\t\t\tcurrent > 0\r\n\t\t\t\t? `${this.getMessage('ITEM_PART')} ${current}/${total}`\r\n\t\t\t\t: ''\r\n\t\t);\r\n\t}\r\n\r\n\tisPart() : boolean {\r\n\t\treturn parseInt(this.getInputValue('PARTIAL_CURRENT')) > 0;\r\n\t}\r\n\r\n\tisFinalPart() : boolean {\r\n\t\tconst current = parseInt(this.getInputValue('PARTIAL_CURRENT')) || 0;\r\n\t\tconst total = parseInt(this.getInputValue('PARTIAL_TOTAL')) || 0;\r\n\r\n\t\treturn (current > 0 && current === total);\r\n\t}\r\n\r\n\tcolumnDefault(item: Object, basketItem: Object, column: string) : string {\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\" data-entity=\"${column}\">${this.valueFormatted(item, basketItem, column)}</td>`;\r\n\t}\r\n\r\n\trenderActions() : string {\r\n\t\treturn '';\r\n\t}\r\n\r\n\twire(key: string, instance: SummarySkeleton) : void {\r\n\t\tthis._wires[key] = instance;\r\n\t}\r\n\r\n\tforgetWires() : void {\r\n\t\tthis._wires = {};\r\n\t}\r\n\r\n\tsetupWires() : void {\r\n\t\tfor (const [key, instance] of Object.entries(this._wires)) {\r\n\t\t\tconst column = this.el.querySelector(`[data-wire=\"${key}\"]`);\r\n\t\t\tconst element = column.firstElementChild;\r\n\r\n\t\t\tif (!element) { continue; }\r\n\r\n\t\t\tinstance.setup(element);\r\n\t\t}\r\n\t}\r\n\r\n\tcallWires(method: string, args: Array = []) : void {\r\n\t\tfor (const [, instance] of Object.entries(this._wires)) {\r\n\t\t\tif (typeof instance[method] !== 'function') { return; }\r\n\r\n\t\t\tinstance[method].apply(instance, args);\r\n\t\t}\r\n\t}\r\n\r\n\tvalueFormatted(item: Object, basketItem: Object, column: string) : string {\r\n\t\tconst formattedKey = column + '_FORMATTED';\r\n\t\tlet result = '';\r\n\r\n\t\tif (item[column] != null) {\r\n\t\t\tresult = item[column];\r\n\t\t} else if (basketItem[formattedKey] != null) {\r\n\t\t\tresult = basketItem[formattedKey];\r\n\t\t} else if (basketItem[column] != null) {\r\n\t\t\tresult = basketItem[column];\r\n\t\t}\r\n\r\n\t\treturn result !== '' ? result : '&mdash;';\r\n\t}\r\n\r\n\tbasketValue(basketItem: Object, column: string) {\r\n\t\treturn basketItem[column];\r\n\t}\r\n\r\n\tvalue(item: Object, basketItem: Object, column: string) {\r\n\t\tif (item[column] != null) {\r\n\t\t\treturn item[column];\r\n\t\t}\r\n\r\n\t\treturn this.basketValue(basketItem, column);\r\n\t}\r\n\r\n\tgetName(field: string) : string {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\thasAction(type: string) : boolean {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n\r\n\tfire(action: string, data: Object = {}) : void {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBasketItemAction', {\r\n\t\t\tdetail: Object.assign({\r\n\t\t\t\titem: this,\r\n\t\t\t\taction: action,\r\n\t\t\t}, data),\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\t}\r\n\r\n\tgetInputValue(field: string) : ?string {\r\n\t\tconst input = this.getInput(field);\r\n\t\tlet result;\r\n\r\n\t\tif (input == null) { return null; }\r\n\r\n\t\tif (input.type === 'checkbox') {\r\n\t\t\tresult = input.checked ? input.value : null;\r\n\t\t} else {\r\n\t\t\tresult = input.value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetInput(field: string) : HTMLInputElement {\r\n\t\tconst name = this.getName(field);\r\n\r\n\t\treturn this.el.querySelector(`input[name=\"${name}\"]`);\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport BoxField from \"../box/field\";\r\nimport {kebabCase} from \"../utils\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tstatic defaults = Object.assign({}, ItemView.defaults);\r\n\r\n\t_moreDropdown;\r\n\r\n\tdestroy() {\r\n\t\tthis.destroyMoreDropdown();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleMoveClick(true);\r\n\t\tthis.handleMoreClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleMoveClick(false);\r\n\t\tthis.handleMoreClick(false);\r\n\t}\r\n\r\n\thandleInputChange(dir: boolean) : void {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input: HTMLInputElement) => {\r\n\t\t\tif (input.name === this.getName('COUNT')) {\r\n\t\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onCountChange);\r\n\t\t\t}\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleMoveClick(dir: boolean) : void {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX)) { return; }\r\n\r\n\t\tthis.el.querySelector('[data-action=\"up\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoveClick);\r\n\r\n\t\tthis.el.querySelector('[data-action=\"down\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoveClick);\r\n\t}\r\n\r\n\thandleMoreClick(dir: boolean) : void {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return; }\r\n\r\n\t\tthis.el\r\n\t\t\t.querySelector('[data-action=\"more\"]')\r\n\t\t\t?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onMoreClick);\r\n\t}\r\n\r\n\tonCountChange = (evt) : void => {\r\n\t\tconst count = parseInt(evt.target.value);\r\n\r\n\t\tif (isNaN(count)) { return; }\r\n\r\n\t\tthis.callWires('updateTotal', [count]);\r\n\t}\r\n\r\n\tonMoveClick = (evt) : void => {\r\n\t\tthis.fire('move', {\r\n\t\t\tdirection: evt.currentTarget.dataset.action,\r\n\t\t});\r\n\t}\r\n\r\n\tonMoreClick = () : void => {\r\n\t\tconst moreDropdown = this.moreDropdown();\r\n\r\n\t\tthis.renewMoreActions(moreDropdown);\r\n\t\tmoreDropdown.popupWindow.show();\r\n\t}\r\n\r\n\tdisableInput(dir: boolean) : void {\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('DELETE')) { return; }\r\n\r\n\t\t\tinput.readonly = dir;\r\n\r\n\t\t\tif (input.classList.contains('ui-ctl-element')) {\r\n\t\t\t\tinput.parentElement.classList.toggle('ui-ctl-disabled', dir);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treplaceName(newName: string) {\r\n\t\tthis.destroyMoreDropdown();\r\n\t\tsuper.replaceName(newName);\r\n\t}\r\n\r\n\tgetCountDiff() : number {\r\n\t\tconst needDelete = this.getInputValue('DELETE');\r\n\t\tconst initialCount = parseInt(this.getInputValue('INITIAL_COUNT'));\r\n\t\tconst count = parseInt(this.getInputValue('COUNT'));\r\n\t\tlet result;\r\n\r\n\t\tif (needDelete) {\r\n\t\t\tresult = initialCount;\r\n\t\t} else {\r\n\t\t\tresult = initialCount - count;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tenableUp(enable: boolean = true) : void {\r\n\t\tthis.el.querySelector('[data-action=\"up\"]').disabled = !enable;\r\n\t}\r\n\r\n\tenableDown(enable: boolean = true) : void {\r\n\t\tthis.el.querySelector('[data-action=\"down\"]').disabled = !enable;\r\n\t}\r\n\t\r\n\tcolumnIndex(item: Object, basketItem: Object, column: string): string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX)) { return super.columnIndex(item, basketItem, column); }\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\"><!--\r\n\t\t\t-->${this.indexHidden(item, basketItem)}<!--\r\n\t\t\t--><button class=\"yamarket-icon-action\" type=\"button\" data-action=\"down\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 11.314 16.657\">\r\n\t\t\t\t\t<path d=\"M4.657 0h2v12.828l3.242-3.242L11.314 11l-5.657 5.657L0 11l1.414-1.414 3.243 3.242V0Z\" fill=\"currentColor\"/>\r\n\t\t\t\t</svg>\r\n\t\t\t</button><!--\r\n\t\t\t--><button class=\"yamarket-icon-action\" type=\"button\" data-action=\"up\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 11.314 17.416\">\r\n\t\t\t\t\t<path d=\"M11.314 5.67 9.896 7.081l-3.255-3.27-.014 13.605-2-.002.014-13.568-3.23 3.215L0 5.644 5.67 0l5.644 5.67Z\" fill=\"currentColor\"/>\r\n\t\t\t\t</svg>\r\n\t\t\t</button><!--\r\n\t\t--></td>`;\r\n\t}\r\n\r\n\tcolumnCount(item: Object, basketItem: Object, column: string) : string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return super.columnCount(item, basketItem, column); }\r\n\r\n\t\tconst value = this.value(item, basketItem, column);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\t\tconst partialCurrent = item?.PARTIAL_COUNT?.CURRENT;\r\n\t\tconst partialTotal = item?.PARTIAL_COUNT?.TOTAL;\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(column)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('OFFSET')}\" value=\"${parseInt(this.value(item, basketItem, 'OFFSET')) || 0}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_CURRENT')}\" value=\"${partialCurrent || ''}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('PARTIAL_TOTAL')}\" value=\"${partialTotal || ''}\" />\r\n\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\" data-entity=\"COUNT\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tclass=\"ui-ctl-element\"\r\n\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\tname=\"${this.getName('COUNT')}\"\r\n\t\t\t\t\tvalue=\"${valueSanitized}\"\r\n\t\t\t\t\tmin=\"1\"\r\n\t\t\t\t\tmax=\"${valueSanitized}\"\r\n\t\t\t\t\tstep=\"1\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<span data-entity=\"PARTIAL_TEXT\">${this.partialText(partialCurrent, partialTotal)}</span>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tsetCount(count: number) : void {\r\n\t\tthis.getInput('COUNT').value = count;\r\n\t}\r\n\r\n\tsetInitialCount(count: number) {\r\n\t\tthis.getInput('COUNT').max = count;\r\n\t\tsuper.setInitialCount(count);\r\n\t}\r\n\r\n\trenderActions() : string {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM)) { return ''; }\r\n\r\n\t\treturn `<td class=\"for--delete\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('DELETE')}\" value=\"\" />\r\n\t\t\t<button class=\"yamarket-icon-action\" type=\"button\" data-action=\"more\">\r\n\t\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 14 3.5\">\r\n\t\t\t\t\t<path d=\"M3.5 1.75C3.5 2.71653 2.7165 3.5 1.75 3.5C0.783501 3.5 0 2.71653 0 1.75C0 0.783475 0.783501 0 1.75 0C2.7165 0 3.5 0.783475 3.5 1.75L3.5 1.75Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t<path d=\"M8.75 1.75C8.75 2.71653 7.96653 3.5 7 3.5C6.03347 3.5 5.25 2.71653 5.25 1.75C5.25 0.783475 6.03347 0 7 0C7.96653 0 8.75 0.783475 8.75 1.75L8.75 1.75Z\" fill=\"currentColor\" />\r\n\t\t\t\t\t<path d=\"M12.25 3.5C13.2165 3.5 14 2.71653 14 1.75C14 0.783475 13.2165 0 12.25 0C11.2835 0 10.5 0.783475 10.5 1.75C10.5 2.71653 11.2835 3.5 12.25 3.5L12.25 3.5Z\" fill=\"currentColor\" />\r\n\t\t\t\t</svg>\r\n\t\t\t</button>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tdestroyMoreDropdown() : void {\r\n\t\tif (this._moreDropdown == null) { return; }\r\n\r\n\t\tBX.PopupMenu.destroy(`${this.options.name}-more`);\r\n\t\tthis._moreDropdown = null;\r\n\t}\r\n\r\n\tmoreDropdown() : BX.PopupMenu {\r\n\t\tif (this._moreDropdown == null) {\r\n\t\t\tthis._moreDropdown = BX.PopupMenu.create(\r\n\t\t\t\t`${this.options.name}-more`,\r\n\t\t\t\tthis.el.querySelector('[data-action=\"more\"]'),\r\n\t\t\t\t[]\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this._moreDropdown;\r\n\t}\r\n\r\n\trenewMoreActions(dropdown: BX.PopupMenu) : void {\r\n\t\tconst previousIds = dropdown.getMenuItems().map((menuItem) => menuItem.id);\r\n\r\n\t\tfor (const previousId of previousIds) {\r\n\t\t\tdropdown.removeMenuItem(previousId, { destroyEmptyPopup: false });\r\n\t\t}\r\n\r\n\t\tfor (const action of this.moreActions(dropdown)) {\r\n\t\t\tdropdown.addMenuItem(action);\r\n\t\t}\r\n\t}\r\n\r\n\tmoreActions(dropdown: BX.PopupMenu) : Array {\r\n\t\treturn (\r\n\t\t\tthis.moreActionsForSplit(dropdown)\r\n\t\t\t\t.concat(this.moreActionsForDelete(dropdown))\r\n\t\t);\r\n\t}\r\n\r\n\tmoreActionsForDelete(dropdown: BX.PopupMenu) : Array {\r\n\t\tif (!this.hasAction(BoxField.ACTION_ITEM) || this.isPart()) { return []; }\r\n\r\n\t\tconst result = [];\r\n\t\tconst deleteInput = this.getInput('DELETE');\r\n\r\n\t\tif (deleteInput.value === 'Y') {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.markDeleted(false);\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_CANCEL_DELETE'),\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.markDeleted(true);\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_DELETE'),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tmoreActionsForSplit(dropdown: BX.PopupMenu) : Array {\r\n\t\tif (!this.hasAction(BoxField.ACTION_BOX) || this.getInputValue('DELETE') === 'Y') { return []; }\r\n\r\n\t\tconst result = [];\r\n\t\tconst currentInput = this.getInput('PARTIAL_CURRENT');\r\n\r\n\t\tif (currentInput.value > 0) {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.fire('cancelSplit');\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_CANCEL_SPLIT'),\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tresult.push({\r\n\t\t\t\tonclick: () => {\r\n\t\t\t\t\tdropdown.popupWindow.close();\r\n\t\t\t\t\tthis.fire('split');\r\n\t\t\t\t},\r\n\t\t\t\ttext: this.getMessage('ITEM_SPLIT'),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tmarkDeleted(needDelete: boolean = true) : void {\r\n\t\tconst deleteInput = this.getInput('DELETE');\r\n\r\n\t\tdeleteInput.value = needDelete ? 'Y' : '';\r\n\t\tthis.el.classList[needDelete ? 'add' : 'remove']('is--deleted');\r\n\t\tthis.disableInput(needDelete);\r\n\r\n\t\tthis.options.onChange();\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './basket.css';\r\n\r\nexport default class Basket {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tmode: null,\r\n\t\tname: null,\r\n\t\ttitle: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options: Object) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.items = [];\r\n\t\tthis.nextIndex = 0;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tsameBasketItems(basketItem: ItemView) : ItemView[] {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (basketItem.id() === item.id()) {\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcountChanges() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (!(item instanceof ItemEdit)) { continue; }\r\n\r\n\t\t\tconst diff = item.getCountDiff();\r\n\r\n\t\t\tif (diff > 0) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tname: item.getTitle(),\r\n\t\t\t\t\tdiff: diff,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(boxItems: Array, basket: Object) : void {\r\n\t\tthis.renderSelf();\r\n\r\n\t\tthis.renewItems(boxItems.length).forEach((basketItem: ItemView, index: number) : void => {\r\n\t\t\tbasketItem.render(boxItems[index], basket);\r\n\t\t\tbasketItem.mount(this.el);\r\n\t\t});\r\n\t}\r\n\r\n\tmount(point) : void {\r\n\t\tpoint.after(this.el);\r\n\t}\r\n\r\n\trenderSelf() {\r\n\t\tthis.el = htmlToElement(`<tbody></tbody>`, 'table');\r\n\t}\r\n\r\n\trenewItems(count: number) : ItemView[] {\r\n\t\tthis.destroyItems();\r\n\r\n\t\treturn this.createItems(count);\r\n\t}\r\n\r\n\tdestroyItems() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItems(count: number) : ItemView[] {\r\n\t\tthis.items = [];\r\n\r\n\t\tfor (let i = 0; i < count; ++i) {\r\n\t\t\tthis.items.push(this.createItem(i));\r\n\t\t}\r\n\r\n\t\tthis.nextIndex = this.items.length;\r\n\r\n\t\treturn this.items;\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\tif (this.options.mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\tmoveItem(item: ItemView, count: ?number = null) : ItemView {\r\n\t\tconst sameItems = this.sameBasketItems(item);\r\n\r\n\t\tif (sameItems.length > 0) {\r\n\t\t\tconst sameItem = sameItems[0];\r\n\r\n\t\t\tif (count != null) {\r\n\t\t\t\tsameItem.setCount(sameItem.getCount() + count);\r\n\t\t\t\tsameItem.setInitialCount(sameItem.getInitialCount() + count);\r\n\t\t\t} else {\r\n\t\t\t\tsameItem.setCount(sameItem.getCount() + item.getCount());\r\n\t\t\t\tsameItem.setInitialCount(sameItem.getInitialCount() + item.getInitialCount());\r\n\t\t\t}\r\n\r\n\t\t\titem.destroy();\r\n\r\n\t\t\treturn sameItem;\r\n\t\t}\r\n\r\n\t\tthis.items.push(item);\r\n\t\titem.replaceName(`${this.options.name}[${this.nextIndex}]`);\r\n\t\titem.mount(this.el);\r\n\r\n\t\tif (count != null) {\r\n\t\t\titem.setCount(count);\r\n\t\t\titem.setInitialCount(count);\r\n\t\t}\r\n\r\n\t\t++this.nextIndex;\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\tdetachItem(item: ItemView) : void {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t\titem.el.remove();\r\n\t}\r\n}","import { htmlToElement } from \"../utils\";\r\nimport Basket from \"../basket/basket\";\r\n\r\nexport default class ItemView {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.basket.destroy();\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tonlyForPart() : boolean {\r\n\t\tlet result = false;\r\n\r\n\t\tfor (const basketItem of this.basket.items) {\r\n\t\t\tif (basketItem.isPart()) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttitle() : string {\r\n\t\treturn this.el.querySelector('.yamarket-basket-box__title').textContent.trim();\r\n\t}\r\n\r\n\trender(box: Object, basket: Object) : void {\r\n\t\tthis.renderSelf(box, basket);\r\n\t\tthis.renderBasket(box, basket);\r\n\t}\r\n\r\n\trenderSelf(box: Object, basket: Object) : void {\r\n\t\tthis.el = htmlToElement(`<tbody>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"yamarket-basket-box\" colspan=\"${this.columnCount(basket)}\">\r\n\t\t\t\t\t<span class=\"yamarket-basket-box__title\">\r\n\t\t\t\t\t\t${this.getMessage('BOX')}\r\n\t\t\t\t\t\t&numero;${box['NUMBER']}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t${this.buildActions(box)}\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</tbody>`, 'table');\r\n\t}\r\n\r\n\thideSelf() : void {\r\n\t\tthis.el.hidden = true;\r\n\t}\r\n\r\n\trenderBasket(box: Object, basket: Object) : void {\r\n\t\tthis.basket = new Basket(this.basketOptions());\r\n\t\tthis.basket.render(box['ITEMS'] ?? [], basket);\r\n\t}\r\n\r\n\tbasketOptions() : Object {\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\treturn {\r\n\t\t\tname: this.options.name + `[ITEMS]`,\r\n\t\t\tmode: BX.UI.EntityEditorMode.view,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\t}\r\n\r\n\tcolumnCount(basket: Object) : number {\r\n\t\treturn Object.keys(basket.COLUMNS).length + 1;\r\n\t}\r\n\r\n\tbuildActions(box: Object) : string {\r\n\t\treturn '';\r\n\t}\r\n\r\n\tdetach() : void {\r\n\t\tthis.el.remove();\r\n\t\tthis.basket.el.remove();\r\n\t}\r\n\r\n\tmount(point: HTMLElement, after: ?HTMLElement = null) {\r\n\t\tif (after != null) {\r\n\t\t\t(after.nextElementSibling ?? after).after(this.el);\r\n\t\t} else {\r\n\t\t\tpoint.querySelector('table').appendChild(this.el);\r\n\t\t}\r\n\r\n\t\tthis.basket.mount(this.el);\r\n\t}\r\n\r\n\tupdateNumber(number: number) : void {\r\n\t\tconst title = this.el.querySelector('.yamarket-basket-box__title');\r\n\r\n\t\ttitle.innerHTML = `${this.getMessage('BOX')} &numero;${number}`;\r\n\t}\r\n\r\n\tgetName(field: string) : string {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport {collectValues} from \"../utils\";\r\n\r\nexport default class BasketItemMoveModal {\r\n\r\n\tstatic defaults = {\r\n\t\tcount: 0,\r\n\t\tcurrent: null,\r\n\t\tselected: null,\r\n\t\titems: [],\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, BasketItemMoveModal.defaults, options);\r\n\t}\r\n\r\n\tonSaveClick(messageBox, resolve, reject) : void {\r\n\t\tconst values = collectValues(messageBox.popupWindow.contentContainer);\r\n\t\tconst count = parseInt(values['COUNT']) || 0;\r\n\r\n\t\tif (count <= 0) {\r\n\t\t\treject();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tmessageBox.close();\r\n\t\tresolve([\r\n\t\t\tvalues['BOX'] === 'new' ? null : this.options.items[values['BOX']],\r\n\t\t\tcount\r\n\t\t]);\r\n\t}\r\n\r\n\tonCancelClick(messageBox, reject) : void {\r\n\t\tmessageBox.close();\r\n\t\treject();\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options  = this.dialogOptions();\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\t\tmessageBox.setMessage(this.buildForm());\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox, resolve, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogOptions() : Object {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('ITEM_MOVE_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tbuildForm() : string {\r\n\t\tlet foundBox = false;\r\n\r\n\t\treturn `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_MOVE_COUNT')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"number\" name=\"COUNT\" value=\"${parseInt(this.options.count) || 0}\" min=\"1\" max=\"${parseInt(this.options.count) || 0}\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_MOVE_BOX')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"BOX\">\r\n\t\t\t\t\t\t${this.options.items.map((item: ItemView, index: number) : string => {\r\n\t\t\t\t\t\t\tif (item === this.options.current) { return ''; }\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst selected = (item === this.options.selected);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (selected) { foundBox = true; }\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treturn `<option value=\"${index}\" ${selected ? 'selected' : ''}>${item.title()}</option>`;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t<option value=\"new\" ${!foundBox ? 'selected' : ''}>${this.getMessage('ITEM_MOVE_BOX_NEW')}</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","import {collectValues} from \"../utils\";\r\n\r\nexport default class BasketItemSplitModal {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tonSaveClick(messageBox, resolve, reject) : void {\r\n\t\tconst values = collectValues(messageBox.popupWindow.contentContainer);\r\n\t\tconst count = parseInt(values['COUNT']) || 0;\r\n\r\n\t\tmessageBox.close();\r\n\t\tcount >= 2 ? resolve(count) : reject();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, reject) : void {\r\n\t\tmessageBox.close();\r\n\t\treject();\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst options  = this.dialogOptions();\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\t\tmessageBox.setMessage(this.buildForm());\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox, resolve, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, reject),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogOptions() : Object {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('ITEM_SPLIT_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tbuildForm() : string {\r\n\t\treturn `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ITEM_SPLIT_COUNT')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"number\" name=\"COUNT\" value=\"2\" min=\"2\" max=\"99\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","export default class BoxOnlyPartDeleteModal {\r\n\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t}\r\n\r\n\tconstructor(options: Object = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\topen() : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create();\r\n\r\n\t\t\tmessageBox.setMessage(this.getMessage('BOX_DELETE_PART_BY_MERGE'));\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tmessageBox.close();\r\n\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tmessageBox.close();\r\n\t\t\t\t\t\t\treject();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tthis.handleDeleteClick(false);\r\n\t}\r\n\r\n\thandleDeleteClick(dir: boolean) : void {\r\n\t\tconst button = this.el.querySelector('[data-action=\"DELETE\"]');\r\n\r\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\tonDeleteClick = (evt) => {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBoxDelete', {\r\n\t\t\tdetail: { item: this },\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\trender(box: Object, basket: Object) : void {\r\n\t\tsuper.render(box, basket);\r\n\t\tthis.handleDeleteClick(true);\r\n\t}\r\n\r\n\tcolumnCount(basket: Object) : number {\r\n\t\treturn super.columnCount(basket) + 1;\r\n\t}\r\n\r\n\tenableDelete(enable: boolean) : void {\r\n\t\tconst button = this.el.querySelector('[data-action=\"DELETE\"]');\r\n\r\n\t\tbutton.disabled = !enable;\r\n\t\tbutton.hidden = !enable;\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn `<button\r\n\t\t\tclass=\"yamarket-icon-action\"\r\n\t\t\ttype=\"button\"\r\n\t\t\ttitle=\"${this.getMessage('BOX_DELETE')}\"\r\n\t\t\tdata-action=\"DELETE\"\r\n\t\t>\r\n\t\t\t<svg class=\"yamarket-icon-action__draw\" viewBox=\"0 0 14 15\">\r\n\t\t\t\t<path d=\"M13.126 1.406v.933a.47.47 0 0 1-.47.469H.47A.47.47 0 0 1 0 2.338v-.932c0-.259.21-.47.47-.47h3.512L4.258.39A.76.76 0 0 1 4.884 0h3.353c.262.014.5.16.63.389l.277.548h3.516a.47.47 0 0 1 .466.47zM.939 3.75h11.25l-.626 9.932A1.424 1.424 0 0 1 10.16 15H2.963a1.424 1.424 0 0 1-1.4-1.318L.94 3.75z\" fill=\"currentColor\" fill-rule=\"evenodd\"/>\r\n\t\t\t</svg>\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbasketOptions(): Object {\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\treturn Object.assign(super.basketOptions(), {\r\n\t\t\tmode: BX.UI.EntityEditorMode.edit,\r\n\t\t});\r\n\t}\r\n}","import Field from \"./field\";\r\nimport ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport BasketItem from \"../basket/itemview\";\r\n\r\nexport default class Collection {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tactions: [],\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\titems: ItemView[];\r\n\tnextIndex: number = 0;\r\n\tanchor: HTMLElement;\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.destroyItems();\r\n\t}\r\n\r\n\tgetMessage(key: string) : string {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tmovableBox(box: ItemView, direction: boolean) : ?ItemView {\r\n\t\treturn direction ? this.nextMovableBox(box) : this.previousMovableBox(box);\r\n\t}\r\n\r\n\tpreviousMovableBox(box: ItemView) : ?ItemView {\r\n\t\tlet previous;\r\n\t\tlet result;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (item === box) {\r\n\t\t\t\tresult = previous;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (!item.onlyForPart()) {\r\n\t\t\t\tprevious = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tnextMovableBox(box: ItemView) : ?ItemView {\r\n\t\tlet found = false;\r\n\t\tlet result;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (found && !item.onlyForPart()) {\r\n\t\t\t\tresult = item;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (item === box) {\r\n\t\t\t\tfound = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(boxes: Array, basket: Object, mode: number) : void {\r\n\t\tconst items = [];\r\n\t\tlet index = 0;\r\n\r\n\t\tthis.destroyItems();\r\n\r\n\t\tfor (const one of boxes) {\r\n\t\t\tconst box = this.createItem(index, mode);\r\n\r\n\t\t\tbox.render(one, basket);\r\n\t\t\titems.push(box);\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tthis.items = items;\r\n\t\tthis.nextIndex = index;\r\n\t}\r\n\r\n\tmount(point: HTMLElement) : void {\r\n\t\tthis.anchor = point;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.mount(point);\r\n\t\t}\r\n\t}\r\n\r\n\taddItem(basket: Object, mode: number) : ItemView {\r\n\t\tconst number = this.items.length + 1;\r\n\t\tconst box = this.createItem(this.nextIndex, mode);\r\n\t\tconst last = this.items[this.items.length - 1]?.el;\r\n\r\n\t\tbox.render({ 'NUMBER': number }, basket);\r\n\t\tbox.mount(this.anchor, last);\r\n\r\n\t\tthis.items.push(box);\r\n\t\t++this.nextIndex;\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tdestroyItems() : void {\r\n\t\tif (this.items == null) { return; }\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItem(index: number, mode: number) : ItemView {\r\n\t\tconst options = {\r\n\t\t\tname: this.options.name + `[${index}]`,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\t// noinspection JSUnresolvedReference\r\n\t\tif (mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\tdeleteItem(item: ItemView) : void {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t\titem.detach();\r\n\t\titem.destroy();\r\n\t}\r\n\r\n\trefresh(basketItem: BasketItem = null) : void {\r\n\t\tif (basketItem != null) {\r\n\t\t\tthis.refreshBasketOffset(basketItem);\r\n\t\t}\r\n\r\n\t\tthis.refreshBoxDelete();\r\n\t\tthis.refreshBasketMove();\r\n\t\tthis.refreshNumber();\r\n\t}\r\n\r\n\trefreshNumber() : void {\r\n\t\tlet num = 1;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tbox.updateNumber(num);\r\n\t\t\t++num;\r\n\t\t}\r\n\t}\r\n\r\n\tbasketItemBox(basketItem: BasketItem) : ItemView {\r\n\t\tlet result;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tfor (const sibling of box.basket.items) {\r\n\t\t\t\tif (sibling === basketItem) {\r\n\t\t\t\t\tresult = box;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (result != null) { break; }\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trefreshBoxDelete() : void {\r\n\t\tconst canDelete = (this.items.length > 1);\r\n\t\tconst canEdit = (this.options.actions.indexOf(Field.ACTION_BOX) !== -1);\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tif (!canDelete && !canEdit) {\r\n\t\t\t\tbox.hideSelf();\r\n\t\t\t} else if (box instanceof ItemEdit) {\r\n\t\t\t\tbox.enableDelete(canDelete);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trefreshBasketMove() : void {\r\n\t\tif ((this.options.actions.indexOf(Field.ACTION_BOX) === -1)) { return; }\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tconst onlyForPart = box.onlyForPart();\r\n\t\t\tconst hasPrevious = (!onlyForPart && this.previousMovableBox(box) != null);\r\n\t\t\tconst hasNext = (!onlyForPart && this.nextMovableBox(box) != null);\r\n\r\n\t\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\t\tbasketItem.enableUp(hasPrevious);\r\n\t\t\t\tbasketItem.enableDown(\r\n\t\t\t\t\thasNext\r\n\t\t\t\t\t|| (\r\n\t\t\t\t\t\t!onlyForPart\r\n\t\t\t\t\t\t&& (box.basket.items.length > 1 || basketItem.getCount() > 1)\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsameBasketItems(basketItem: BasketItem) : BasketItem[] {\r\n\t\tlet result = [];\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tresult = result.concat(box.basket.sameBasketItems(basketItem));\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trefreshBasketOffset(basketItem: BasketItem) : void {\r\n\t\tconst sameItems = this.sameBasketItems(basketItem);\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor (const sameItem of sameItems) {\r\n\t\t\tsameItem.setOffset(offset);\r\n\r\n\t\t\tif (!sameItem.isPart() || sameItem.isFinalPart()) {\r\n\t\t\t\toffset += sameItem.getInitialCount();\r\n\t\t\t}\r\n\r\n\t\t\tsameItem.updateCisCount();\r\n\t\t}\r\n\t}\r\n\r\n}","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement, kebabCase} from \"../utils\";\r\nimport ItemView from './itemview';\r\nimport BasketItem from '../basket/itemview';\r\nimport BasketItemMoveModal from \"./basketitemmovemodal\";\r\nimport BasketItemSplitModal from \"./basketitemsplitmodal\";\r\nimport BoxOnlyPartDeleteModal from \"./boxonlypartdeletemodal\";\r\nimport Collection from \"./collection\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic ACTION_BOX = 'box';\r\n\tstatic ACTION_ITEM = 'item';\r\n\tstatic ACTION_CIS = 'cis';\r\n\tstatic ACTION_DIGITAL = 'digital';\r\n\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BOX',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tboxCollection: Collection;\r\n\tpayloadBasket: Object;\r\n\r\n\tstatic create(id, settings) : Field {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleBoxDelete(true);\r\n\t\tthis.handleBasketItemAction(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tthis.handleBoxDelete(false);\r\n\t\tthis.handleBasketItemAction(false);\r\n\t}\r\n\r\n\thandleBoxDelete(dir: boolean) : void {\r\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('yamarketBoxDelete', this.onBoxDelete);\r\n\t}\r\n\r\n\thandleBasketItemAction(dir: boolean) {\r\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('yamarketBasketItemAction', this.onBasketItemAction);\r\n\t}\r\n\r\n\tonChange = () => {\r\n\t\tif (\r\n\t\t\tthis._mode !== BX.UI.EntityEditorMode.edit\r\n\t\t\t&& (this.hasAction(Field.ACTION_CIS) || this.hasAction(Field.ACTION_DIGITAL))\r\n\t\t) {\r\n\t\t\tthis._mode = BX.UI.EntityEditorMode.edit;\r\n\t\t\tthis._editor.showToolPanel();\r\n\t\t\tthis._editor.registerActiveControl(this);\r\n\t\t}\r\n\r\n\t\tthis._changeHandler();\r\n\t}\r\n\r\n\tonBoxDelete = (evt) => {\r\n\t\tconst box: ItemView = evt.detail.item;\r\n\r\n\t\tif (box.onlyForPart()) {\r\n\t\t\t(new BoxOnlyPartDeleteModal({ messages: Field.messages }))\r\n\t\t\t\t.open()\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\t\t\t\tthis.cancelSplitBasketItem(basketItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst newBox = this.boxCollection.previousMovableBox(box) ?? this.boxCollection.nextMovableBox(box);\r\n\r\n\t\tif (newBox == null) { return; }\r\n\r\n\t\tfor (const basketItem of box.basket.items) {\r\n\t\t\tthis.moveBasketItem(basketItem, newBox);\r\n\t\t}\r\n\r\n\t\tthis.boxCollection.deleteItem(box);\r\n\t\tthis.boxCollection.refresh();\r\n\t\tthis.onChange();\r\n\t}\r\n\r\n\tonBasketItemAction = (evt) : void => {\r\n\t\tconst basketItem = evt.detail.item;\r\n\t\tconst action = evt.detail.action;\r\n\r\n\t\tif (action === 'cisUpdate') {\r\n\t\t\tthis.copyCis(basketItem);\r\n\t\t} else if (action === 'move') {\r\n\t\t\tthis.startMoveBasketItem(basketItem, evt.detail.direction === 'down');\r\n\t\t} else if (action === 'split') {\r\n\t\t\tthis.startSplitBasketItem(basketItem);\r\n\t\t} else if (action === 'cancelSplit') {\r\n\t\t\tthis.cancelSplitBasketItem(basketItem);\r\n\t\t}\r\n\t}\r\n\r\n\tcountChanges() : Array {\r\n\t\tlet result = [];\r\n\r\n\t\tfor (const box of this.boxCollection.items) {\r\n\t\t\tresult = result.concat(box.basket.countChanges());\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcopyCis(basketItem: BasketItem) : void {\r\n\t\tconst siblings = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tconst values = basketItem.cis()?.getValues();\r\n\r\n\t\tif (siblings.length <= 1 || values == null) { return; }\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (sibling === basketItem) { continue; }\r\n\r\n\t\t\tsibling.cis()?.setValues(values);\r\n\t\t}\r\n\t}\r\n\r\n\tstartMoveBasketItem(basketItem: BasketItem, direction: boolean) : void {\r\n\t\tconst oldBox = this.boxCollection.basketItemBox(basketItem);\r\n\t\tconst selectedBox = this.boxCollection.movableBox(oldBox, direction);\r\n\t\tconst count = basketItem.getCount();\r\n\r\n\t\tif (basketItem.getCount() <= 1) {\r\n\t\t\tconst newItem = this.moveBasketItem(basketItem, selectedBox ?? this.addBox());\r\n\r\n\t\t\tthis.afterMoveBasketItem(newItem);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t(new BasketItemMoveModal({\r\n\t\t\tcount: count,\r\n\t\t\tcurrent: oldBox,\r\n\t\t\tselected: selectedBox,\r\n\t\t\titems: this.boxCollection.items,\r\n\t\t\tmessages: Field.messages,\r\n\t\t}))\r\n\t\t\t.open()\r\n\t\t\t.then((resolved: Array) : void => {\r\n\t\t\t\tlet [newBox: ?ItemView, moveCount: number] = resolved;\r\n\t\t\t\tlet newItem;\r\n\r\n\t\t\t\tif (newBox == null) { newBox = this.addBox(); }\r\n\r\n\t\t\t\tif (moveCount < count) {\r\n\t\t\t\t\tnewItem = this.moveBasketItem(basketItem, newBox, moveCount, true);\r\n\r\n\t\t\t\t\tbasketItem.setCount(basketItem.getCount() - moveCount);\r\n\t\t\t\t\tbasketItem.setInitialCount(basketItem.getInitialCount() - moveCount);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewItem = this.moveBasketItem(basketItem, newBox);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.afterMoveBasketItem(newItem);\r\n\t\t\t});\r\n\t}\r\n\r\n\tmoveBasketItem(basketItem: BasketItem, newBox: ItemView, count: ?number = null, needClone: boolean = false) : BasketItem {\r\n\t\tif (needClone) {\r\n\t\t\t basketItem = basketItem.clone();\r\n\t\t} else {\r\n\t\t\tconst oldBox = this.boxCollection.basketItemBox(basketItem);\r\n\r\n\t\t\toldBox.basket.detachItem(basketItem);\r\n\r\n\t\t\tif (oldBox.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(oldBox);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newBox.basket.moveItem(basketItem, count);\r\n\t}\r\n\r\n\tafterMoveBasketItem(basketItem: BasketItem) : void {\r\n\t\tthis.boxCollection.refresh(basketItem);\r\n\t\tthis.onChange();\r\n\t}\r\n\r\n\tstartSplitBasketItem(basketItem: BasketItem) : void {\r\n\t\t(new BasketItemSplitModal({ messages: Field.messages }))\r\n\t\t\t.open()\r\n\t\t\t.then((count: number) : void => this.splitBasketItem(basketItem, count));\r\n\t}\r\n\r\n\tsplitBasketItem(basketItem: BasketItem, total: number) : void {\r\n\t\tconst [deletedCount, deletedInitialCount] = this.removeBasketItemSiblings(basketItem);\r\n\t\tconst count = (basketItem.getCount() || 1) + deletedCount;\r\n\t\tconst initialCount = (basketItem.getInitialCount() || 1) + deletedInitialCount;\r\n\r\n\t\tfor (let productIndex = 0; productIndex < count; ++productIndex) {\r\n\t\t\tfor (let i = 0; i < total; ++i) {\r\n\t\t\t\tconst isSelf = (productIndex === 0 && i === 0);\r\n\t\t\t\tconst box = this.addBox();\r\n\t\t\t\tconst newItem = this.moveBasketItem(basketItem, box, 1, !isSelf);\r\n\r\n\t\t\t\tnewItem.setPart(i, total);\r\n\r\n\t\t\t\tif (productIndex === 0) {\r\n\t\t\t\t\tnewItem.setInitialCount(1 + (initialCount - count));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.afterMoveBasketItem(basketItem);\r\n\t}\r\n\r\n\tremoveBasketItemSiblings(basketItem: BasketItem) : [number, number] {\r\n\t\tconst sameItems = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tlet deletedCount = 0;\r\n\t\tlet deletedInitialCount = 0;\r\n\r\n\t\tfor (const sameItem of sameItems) {\r\n\t\t\tif (sameItem === basketItem) { continue; }\r\n\r\n\t\t\tconst box = this.boxCollection.basketItemBox(sameItem);\r\n\r\n\t\t\tdeletedCount += sameItem.getCount() || 0;\r\n\t\t\tdeletedInitialCount += sameItem.getInitialCount() || 0;\r\n\r\n\t\t\tbox.basket.detachItem(sameItem);\r\n\r\n\t\t\tif (box.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(box);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [deletedCount, deletedInitialCount];\r\n\t}\r\n\r\n\tcancelSplitBasketItem(basketItem: BasketItem) : void {\r\n\t\tconst siblings = this.boxCollection.sameBasketItems(basketItem);\r\n\t\tconst [count, initialCount] = this.countSiblings(siblings);\r\n\t\tlet firstSibling = null;\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (firstSibling == null) {\r\n\t\t\t\tconst box = this.boxCollection.basketItemBox(sibling);\r\n\t\t\t\tconst previousBox = this.boxCollection.previousMovableBox(box) ?? this.boxCollection.nextMovableBox(box);\r\n\r\n\t\t\t\tsibling.resetPart();\r\n\t\t\t\tsibling.setCount(count);\r\n\t\t\t\tsibling.setInitialCount(initialCount);\r\n\t\t\t\tsibling.setOffset(0);\r\n\t\t\t\tsibling.updateCisCount();\r\n\r\n\t\t\t\tif (previousBox != null) {\r\n\t\t\t\t\tthis.moveBasketItem(sibling, previousBox);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfirstSibling = sibling;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst box = this.boxCollection.basketItemBox(sibling);\r\n\r\n\t\t\tbox.basket.detachItem(sibling);\r\n\r\n\t\t\tif (box.basket.items.length === 0) {\r\n\t\t\t\tthis.boxCollection.deleteItem(box);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfirstSibling && this.afterMoveBasketItem(firstSibling);\r\n\t}\r\n\r\n\tcountSiblings(siblings: BasketItem[]) : [number, number] {\r\n\t\tlet count = 0;\r\n\t\tlet initialCount = 0;\r\n\r\n\t\tfor (const sibling of siblings) {\r\n\t\t\tif (!sibling.isPart() || sibling.isFinalPart()) {\r\n\t\t\t\tcount += sibling.getCount() || 0;\r\n\t\t\t\tinitialCount += sibling.getInitialCount() || 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [count, initialCount];\r\n\t}\r\n\r\n\taddBox() : ItemView {\r\n\t\treturn this.boxCollection.addItem(this.payloadBasket, this._mode);\r\n\t}\r\n\r\n\trender(payload: Object) : void {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.options.actions = payload.ACTIONS;\r\n\t\tthis.payloadBasket = payload.BASKET;\r\n\r\n\t\tthis.renderSelf(payload['BOX'].length);\r\n\t\tthis.renderBoxes(payload['BOX']);\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\trenderSelf(boxCount: number) : void {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-basket\">\r\n\t\t\t<input type=\"hidden\" name=\"BOX_INITIAL_COUNT\" value=\"${boxCount}\" />\r\n\t\t\t<div class=\"yamarket-basket-table-viewport\">\r\n\t\t\t\t<table class=\"yamarket-basket-table\">\r\n\t\t\t\t\t${this.renderHeader()}\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t${this.renderSummary()}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\trenderHeader() : string {\r\n\t\treturn `<thead>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"for--index\">&numero;</td>\r\n\t\t\t\t${Object.keys(this.payloadBasket.COLUMNS)\r\n\t\t\t\t\t.map((key) => `<td class=\"for--${kebabCase(key)}\">${this.columnTitle(key)}</td>`)\r\n\t\t\t\t\t.join('')}\r\n\t\t\t\t${this.isInEditMode() && this.hasAction(Field.ACTION_ITEM) ? '<td class=\"for--delete\">&nbsp;</td>' : ''}\r\n\t\t\t</tr>\r\n\t\t</thead>`;\r\n\t}\r\n\r\n\tcolumnTitle(key: string) : string {\r\n\t\tconst langKey = 'HEADER_' + key;\r\n\t\tconst lang = this.getMessage(langKey);\r\n\r\n\t\treturn lang !== langKey ? lang : this.payloadBasket.COLUMNS[key];\r\n\t}\r\n\r\n\trenderSummary() : string {\r\n\t\tif (this.payloadBasket.SUMMARY.length === 0) { return ''; }\r\n\r\n\t\treturn `<div class=\"yamarket-basket-summary\">\r\n\t\t\t${this.payloadBasket.SUMMARY\r\n\t\t\t\t.map((item) => {\r\n\t\t\t\t\treturn `<div class=\"yamarket-basket-summary__row\">\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__label\">${item['NAME']}:</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__value\">${item['VALUE']}</div>\r\n\t\t\t\t\t</div>`;\r\n\t\t\t\t})\r\n\t\t\t\t.join('')}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\trenderBoxes(boxes: Array) : void {\r\n\t\tthis.boxCollection?.destroy();\r\n\r\n\t\tthis.boxCollection = new Collection({\r\n            name: this.options.name,\r\n            messages: Field.messages,\r\n            actions: this.options.actions,\r\n            onChange: this.onChange,\r\n        });\r\n\t\tthis.boxCollection.render(boxes, this.payloadBasket, this._mode);\r\n\t\tthis.boxCollection.refreshBasketMove();\r\n\t\tthis.boxCollection.refreshBoxDelete();\r\n\t\tthis.boxCollection.mount(this.el);\r\n\t}\r\n\r\n\thasAction(type: string) : boolean {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}\r\n","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement, collectValues, fillValues} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET_CONFIRM',\r\n\t\treasons: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tvalidate(validator) {\r\n\t\tconst box = this._parent.getChildById('BOX');\r\n\r\n\t\tif (box == null) { return; }\r\n\r\n\t\tconst countChanges = box.countChanges();\r\n\r\n\t\tif (countChanges.length === 0) { return; }\r\n\r\n\t\tthis.resetValues();\r\n\r\n\t\treturn this.showDialog(countChanges, validator);\r\n\t}\r\n\r\n\tresetValues() {\r\n\t\tfillValues(this.el, {\r\n\t\t\t[`${this.options.name}[ALLOW_REMOVE]`]: '',\r\n\t\t});\r\n\t}\r\n\r\n\tshowDialog(countChanges, validator) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create({\r\n\t\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t\t\tmessage: this.dialogBody(countChanges),\r\n\t\t\t});\r\n\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SendButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSendClick.bind(this, messageBox, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, validator, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogBody(countChanges) {\r\n\t\treturn `\r\n\t\t\t${this.options.reasons.length > 0 ? `\r\n\t\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('REASON')}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t\t${this.reasonControl()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t` : ''}\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('PRODUCTS')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.productsControl(countChanges)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-alert ui-alert-warning\">${this.getMessage('FORM_INTRO')}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\treasonControl() {\r\n\t\treturn `<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t<select class=\"ui-ctl-element\" name=\"${this.options.name}[REASON]\">\r\n\t\t\t\t${this.options.reasons.map((option) => `<option value=\"${option['ID']}\">${option['VALUE']}</option>`).join('')}\r\n\t\t\t</select>\r\n\t\t</div>`\r\n\t}\r\n\r\n\tproductsControl(changes) {\r\n\t\treturn changes\r\n\t\t\t.map((change) => {\r\n\t\t\t\treturn this.getMessage('ITEM_CHANGE', {\r\n\t\t\t\t\tNAME: change.name,\r\n\t\t\t\t\tCOUNT: change.diff,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.join('<hr />');\r\n\t}\r\n\r\n\tonSendClick(messageBox, resolve) {\r\n\t\tfillValues(this.el, Object.assign(collectValues(messageBox.popupWindow.contentContainer), {\r\n\t\t\t[`${this.options.name}[ALLOW_REMOVE]`]: 'Y',\r\n\t\t}));\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, validator, resolve) {\r\n\t\tconst error = BX.UI.EntityValidationError.create({\r\n\t\t\tfield: this,\r\n\t\t});\r\n\r\n\t\tthis.resetValues();\r\n\t\tvalidator.addError(error);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.el = htmlToElement(`<div class=\"ui-helper-hidden\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[REASON]\" value=\"\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[ALLOW_REMOVE]\" value=\"\" />\r\n\t\t</div>`)\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\treasons: payload['ITEMS_CHANGE_REASON'],\r\n\t\t});\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tbroadcastElement: '#YAMARKET_ORDER_VIEW',\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tuseTitle() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleActivityEnd(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleActivityEnd(false);\r\n\t}\r\n\r\n\thandleActivityEnd(dir) {\r\n\t\tif (this._activityType == null) { return; }\r\n\r\n\t\tconst broadcast = this.getElement('broadcast');\r\n\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](broadcast, 'yamarketActivitySubmitEnd', this.onActivityEnd);\r\n\t}\r\n\r\n\tonActivityEnd = (type) => {\r\n\t\tif (!this.isMatchActivity(type)) { return; }\r\n\r\n\t\tthis._editor.reload();\r\n\t}\r\n\r\n\tisMatchActivity(type) {\r\n\t\tif (type == null) { return false; }\r\n\r\n\t\treturn (type === this._activityType || type.indexOf(this._activityType + '|') === 0);\r\n\t}\r\n\r\n\tforget() {\r\n\t\tif (!this.el) { return; }\r\n\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst html = this.build(payload);\r\n\r\n\t\tthis._activityType = payload?.ACTIVITY_ACTION?.TYPE;\r\n\r\n\t\tthis.el = htmlToElement(html);\r\n\t\tthis.bind();\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\tbuild(payload) {\r\n\t\tconst activity = payload['ACTIVITY_ACTION'];\r\n\r\n\t\treturn `<div class=\"ui-entity-editor-content-block\">\r\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\r\n\t\t\t\t${BX.util.htmlspecialchars(payload['VALUE'])}\r\n\t\t\t\t${activity ? this.buildActivity(activity, payload) : ''}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildActivity(activity, property) {\r\n\t\tconst title = activity['TEXT'] !== property['NAME'] ? activity['TEXT'] : this.getMessage('ACTIVITY_APPLY');\r\n\t\tconst onclick = this.makeActivityMethod(activity);\r\n\r\n\t\treturn `<small>\r\n\t\t\t<a href=\"#\" onclick='${onclick}; return false'>${title}</a>\r\n\t\t</small>`;\r\n\t}\r\n\r\n\tmakeActivityMethod(activity) {\r\n\t\tlet result;\r\n\r\n\t\tif (activity['MENU'] != null) {\r\n\t\t\tconst items = activity['MENU'].map((action) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttext: action['TEXT'],\r\n\t\t\t\t\tonclick: action['METHOD'],\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tresult = `BX.PopupMenu.show(\"${activity['TYPE']}\", this, ${JSON.stringify(items)}, { angle: { offset: 50 } })`;\r\n\t\t} else {\r\n\t\t\tresult = activity['METHOD'];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './print.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\turl: null,\r\n\t\twidth: 400,\r\n\t\theight: 300,\r\n\t\titems: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbindDocumentsClick() {\r\n\t\tthis._wrapper.querySelectorAll('.yamarket-print__link').forEach((link) => {\r\n\t\t\tlink.addEventListener('click', this.onDocumentClick);\r\n\t\t});\r\n\t}\r\n\r\n\tonDocumentClick = (evt) => {\r\n\t\tconst link = evt.currentTarget;\r\n\t\tconst type = link.dataset.type;\r\n\t\tconst item = this.getItem(type);\r\n\t\tconst url = this.buildDocumentUrl(type);\r\n\t\tconst dialog = this.createDialog(url, item);\r\n\r\n\t\tdialog.Show();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tgetItem(type) {\r\n\t\tlet result;\r\n\r\n\t\tfor (const document of this.options.items) {\r\n\t\t\tif (document['TYPE'] === type) {\r\n\t\t\t\tresult = document;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildDocumentUrl(type) {\r\n\t\tconst url = this.options.url;\r\n\r\n\t\treturn (\r\n\t\t\turl\r\n\t\t\t+ (url.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'type=' + type\r\n\t\t);\r\n\t}\r\n\r\n\tcreateDialog(url, item) {\r\n\t\treturn new BX.YandexMarket.PrintDialog({\r\n\t\t\ttitle: item.DIALOG_TITLE || item.TITLE,\r\n\t\t\tcontent_url: url,\r\n\t\t\twidth: item.WIDTH || this.options.width,\r\n\t\t\theight: item.HEIGHT || this.options.height,\r\n\t\t\tbuttons: [\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnSave,\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnCancel\r\n\t\t\t]\r\n\t\t});\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.extendOptions(value);\r\n\r\n\t\tthis.renderIntro();\r\n\t\tthis.renderDocuments(value['ITEMS']);\r\n\r\n\t\tthis.bindDocumentsClick();\r\n\t}\r\n\r\n\textendOptions(value) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\turl: value['URL'],\r\n\t\t\titems: value['ITEMS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenderIntro() {\r\n\t\tconst element = htmlToElement(`<p class=\"yamarket-print__intro\">${this.getMessage('INTRO')}</p>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n\r\n\trenderDocuments(items) {\r\n\t\tif (!Array.isArray(items)) { return; }\r\n\r\n\t\tconst element = htmlToElement(`<ul class=\"yamarket-print__documents\">\r\n\t\t\t${items.map((document) => `<li class=\"yamarket-print__document\">\r\n\t\t\t\t<a class=\"yamarket-print__link\" href=\"#\" data-type=\"${document['TYPE']}\">${document['TITLE']}</a>\r\n\t\t\t</li>`).join('')}\r\n\t\t</ul>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport './notification.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tif (!Array.isArray(value)) { return; }\r\n\r\n\t\tconst html = value.map((one) => `<div class=\"ui-alert ui-alert-${one.type}\">${one.text}</div>`).join('');\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n}","import Factory from \"./factory\";\r\nimport Box from \"./box/field\";\r\nimport BasketConfirm from \"./basketconfirm/field\";\r\nimport Property from \"./property/field\";\r\nimport Print from \"./print/field\";\r\nimport Notification from \"./notification/field\";\r\nimport Editor from \"./compatible/editor\";\r\nimport './common.css';\r\n\r\n// factory\r\n\r\nconst factory = new Factory({\r\n\tmap: {\r\n\t\tnotification: Notification,\r\n\t\tbox: Box,\r\n\t\tbasket_confirm: BasketConfirm,\r\n\t\tproperty: Property,\r\n\t\tprint: Print,\r\n\t},\r\n});\r\n\r\nfactory.register();\r\n\r\n// compatible\r\n\r\nconst editor = new Editor();\r\n\r\neditor.start();\r\n\r\nexport {\r\n\tNotification,\r\n\tBasketConfirm,\r\n\tBox,\r\n\tProperty,\r\n\tPrint,\r\n};","export default class Editor {\r\n\r\n\tstart() {\r\n\t\tthis.storeOriginDefault();\r\n\t\tthis.handleEditorInit();\r\n\t}\r\n\r\n\thandleEditorInit() {\r\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditor:onInit', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (editor, data) => {\r\n\t\tif (data.id !== 'yamarket_order_tab') { return; }\r\n\r\n\t\tthis.overrideEditor(editor);\r\n\t\tthis.overrideEditorAjax(editor);\r\n\t\tthis.restoreOriginDefault();\r\n\t}\r\n\r\n\tstoreOriginDefault() {\r\n\t\tthis._originDefault = BX?.UI?.EntityEditor?.getDefault();\r\n\t}\r\n\r\n\trestoreOriginDefault() {\r\n\t\tif (this._originDefault == null) { return; }\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tBX?.UI?.EntityEditor?.setDefault(this._originDefault);\r\n\t\t});\r\n\t}\r\n\r\n\toverrideEditor(editor) {\r\n\t\tconst createAjaxForm = editor.createAjaxForm;\r\n\r\n\t\tObject.assign(editor, {\r\n\t\t\tvalidate: this.editorValidate.bind(this, editor),\r\n\t\t\tcreateAjaxForm: this.editorCreateAjaxForm.bind(this, editor, createAjaxForm),\r\n\t\t});\r\n\t}\r\n\r\n\teditorValidate(editor, result) {\r\n\t\tconst validator = BX.UI.EntityAsyncValidator.create();\r\n\r\n\t\tfor (const control of editor._activeControls) {\r\n\t\t\tvalidator.addResult(control.validate(result));\r\n\t\t}\r\n\r\n\t\tif (this._userFieldManager) {\r\n\t\t\tvalidator.addResult(this._userFieldManager.validate(result));\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(validator.validate());\r\n\t}\r\n\r\n\teditorCreateAjaxForm(editor, parentMethod, options, callbacks) {\r\n\t\tconst result = parentMethod.call(editor, options, callbacks);\r\n\r\n\t\tthis.overrideAjaxForm(result);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toverrideEditorAjax(editor) {\r\n\t\tthis.overrideAjaxForm(editor._ajaxForm);\r\n\t}\r\n\r\n\toverrideAjaxForm(ajaxForm) {\r\n\t\tif (!ajaxForm || !BX?.UI?.ComponentAjax || !(ajaxForm instanceof BX.UI.ComponentAjax)) { return; }\r\n\r\n\t\tObject.assign(ajaxForm, {\r\n\t\t\tdoSubmit: this.ajaxFormDoSubmit,\r\n\t\t});\r\n\t}\r\n\r\n\tajaxFormDoSubmit(options) {\r\n\t\tconst formData = this._elementNode\r\n\t\t\t? BX.ajax.prepareForm(this._elementNode)\r\n\t\t\t: {data : BX.clone(this._formData), filesCount : 0};\r\n\r\n\t\tif (BX.type.isPlainObject(options.data)) {\r\n\t\t\tfor (const i in options.data) {\r\n\t\t\t\tif (!options.data.hasOwnProperty(i)) { continue; }\r\n\r\n\t\t\t\tformData.data[i] = options.data[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst resultData = formData.filesCount > 0 ? this.makeFormData(formData) : formData;\r\n\r\n\t\tBX.ajax.runComponentAction(this._className, this._actionName, {\r\n\t\t\tmode: 'ajax',\r\n\t\t\tsignedParameters: this._signedParameters,\r\n\t\t\tdata: resultData,\r\n\t\t\tgetParameters: this._getParameters\r\n\t\t})\r\n\t\t\t.then((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onSuccess\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmit\",\r\n\t\t\t\t\t[ response[\"data\"][\"ENTITY_DATA\"], response ]\r\n\t\t\t\t);\r\n\t\t\t\tcallback(response[\"data\"]);\r\n\t\t\t})\r\n\t\t\t.catch((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onFailure\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tvar messages = [];\r\n\t\t\t\tvar errors = response[\"errors\"];\r\n\t\t\t\tfor(var i = 0, length = errors.length; i < length; i++) {\r\n\t\t\t\t\tmessages.push(errors[i][\"message\"]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmitFailure\",\r\n\t\t\t\t\t[ response[\"errors\"] ]\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcallback({ \"ERRORS\": messages });\r\n\t\t\t});\r\n\t}\r\n\r\n}"],"names":["BX","window","Factory","constructor","options","onEditorInit","factory","event","methods","this","name","build","handleEditorInit","type","controlId","settings","prefix","indexOf","internalType","substr","length","map","hasOwnProperty","create","Object","assign","defaults","register","isEditorInitialized","registerEditorMethod","UI","_BX$UI","EntityEditorControlFactory","_BX$UI$EntityEditorCo","initialized","registerFactoryMethod","dir","htmlToElement","html","tag","renderer","document","createElement","innerHTML","firstElementChild","kebabCase","str","split","word","index","toLowerCase","join","copyValues","from","to","fillValues","collectValues","container","inputs","findInputs","result","input","entries","tagName","option","querySelectorAll","selected","value","values","isChanged","Boolean","replaceTemplateVariables","template","variables","key","replace","Field","EntityEditorField","_hasLayout","getMessage","replaces","messages","super","clearLayout","forget","_wrapper","layout","ensureWrapperCreated","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","appendChild","createDragButton","useTitle","title","getTitle","createTitleNode","render","getValue","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","payload","fewElements","selector","getElementSelector","el","getElement","querySelector","SummarySkeleton","onStatusClick","evt","openDialog","preventDefault","clone","bind","handleStatusClick","status","setup","element","replaceName","oldName","newName","buildStatus","buildForm","cises","optionValue","getStatus","reflowStatus","formValue","setAttribute","textContent","Error","useFormValue","reflowForm","modal","dialogOptions","messageBox","Dialogs","MessageBox","setMessage","cloneNode","setButtons","SaveButton","events","click","onSaveClick","CancelButton","onCancelClick","show","popupWindow","contentContainer","onChange","close","STATUS_READY","STATUS_WAIT","STATUS_EMPTY","modalElement","statusElement","inputElement","Cis","onCopyClick","copyInternal","handleCopyClick","copy","updateTotal","count","updateCount","offset","requiredTypes","internalCises","emptyValues","buildCopyIcon","total","parseInt","iterator","Array","fill","types","dummy","hidden","one","placeholder","hasMessage","inputName","util","htmlspecialchars","includes","fixedCisType","typeVariant","filledCount","empty","trim","filled","itemFilled","setValues","getValues","makeInputValues","selfName","bracketPosition","substring","needAll","disabled","String","dataset","optionKey","instances","fixedType","cisTypes","isArray","instance","valueType","markingType","instanceTypes","slice","foundCis","markingGroup","unshift","minWidth","Math","max","min","keyWithPrefix","copyElement","internalInstances","Digital","buildFormCodes","buildFormAdditional","hasFew","oneValue","ITEM","fieldset","isItemsFilled","filterFilledItems","isSlipFilled","items","item","push","slip","rawValues","base","keyRelative","keyChain","valueKeyChain","setValueByKeyChain","parts","part","chain","lastKey","pop","level","nextKey","test","toTree","ItemView","_wires","destroy","unbind","forgetWires","cloned","wire","setupWires","id","getInputValue","basket","columns","keys","COLUMNS","basketItem","ITEMS","BASKET_KEY","PARTIAL_COUNT","CURRENT","renderColumn","renderActions","mount","point","column","method","toUpperCase","columnDefault","enableUp","enable","enableDown","columnIndex","indexHidden","valueFormatted","identifiersCount","getName","columnCis","cis","basketValue","fire","updateCisCount","getCount","getOffset","columnDigital","digital","columnSubsidy","promos","content","promo","columnCount","valueSanitized","partialCurrent","_item$PARTIAL_COUNT2","partialTotal","_item$PARTIAL_COUNT3","TOTAL","partialText","setCount","getInput","text","setInitialCount","getInitialCount","setOffset","resetPart","classList","remove","setPart","add","current","isPart","isFinalPart","callWires","args","apply","formattedKey","field","hasAction","actions","action","data","dispatchEvent","CustomEvent","detail","bubbles","checked","ItemEdit","onCountChange","target","isNaN","onMoveClick","direction","currentTarget","onMoreClick","moreDropdown","renewMoreActions","destroyMoreDropdown","handleInputChange","handleMoveClick","handleMoreClick","forEach","BoxField","ACTION_BOX","ACTION_ITEM","disableInput","readonly","contains","parentElement","toggle","getCountDiff","needDelete","initialCount","parseFloat","_item$PARTIAL_COUNT","_moreDropdown","PopupMenu","dropdown","previousIds","getMenuItems","menuItem","previousId","removeMenuItem","destroyEmptyPopup","moreActions","addMenuItem","moreActionsForSplit","concat","moreActionsForDelete","onclick","markDeleted","Basket","nextIndex","sameBasketItems","countChanges","diff","boxItems","renderSelf","renewItems","after","destroyItems","createItems","i","createItem","mode","EntityEditorMode","edit","moveItem","sameItems","sameItem","detachItem","splice","onlyForPart","box","renderBasket","buildActions","hideSelf","basketOptions","view","detach","nextElementSibling","updateNumber","number","BasketItemMoveModal","resolve","reject","open","Promise","foundBox","BasketItemSplitModal","BoxOnlyPartDeleteModal","onDeleteClick","handleDeleteClick","enableDelete","button","Collection","movableBox","nextMovableBox","previousMovableBox","previous","found","boxes","anchor","addItem","last","_this$items","deleteItem","refresh","refreshBasketOffset","refreshBoxDelete","refreshBasketMove","refreshNumber","num","basketItemBox","sibling","canDelete","canEdit","hasPrevious","hasNext","ReferenceField","_mode","ACTION_CIS","ACTION_DIGITAL","_editor","showToolPanel","registerActiveControl","_changeHandler","onBoxDelete","then","cancelSplitBasketItem","newBox","boxCollection","moveBasketItem","onBasketItemAction","copyCis","startMoveBasketItem","startSplitBasketItem","initialize","handleBoxDelete","handleBasketItemAction","siblings","_basketItem$cis","oldBox","selectedBox","newItem","addBox","afterMoveBasketItem","resolved","moveCount","needClone","splitBasketItem","deletedCount","deletedInitialCount","removeBasketItemSiblings","productIndex","isSelf","countSiblings","firstSibling","previousBox","payloadBasket","ACTIONS","BASKET","renderBoxes","boxCount","renderHeader","renderSummary","columnTitle","isInEditMode","langKey","lang","SUMMARY","validate","validator","_parent","getChildById","resetValues","showDialog","message","dialogBody","SendButton","onSendClick","reasons","reasonControl","productsControl","changes","change","NAME","COUNT","error","EntityValidationError","addError","extendOptions","onActivityEnd","isMatchActivity","reload","handleActivityEnd","_activityType","broadcast","ACTIVITY_ACTION","_payload$ACTIVITY_ACT","TYPE","activity","buildActivity","property","makeActivityMethod","JSON","stringify","broadcastElement","onDocumentClick","getItem","url","buildDocumentUrl","createDialog","Show","bindDocumentsClick","link","addEventListener","YandexMarket","PrintDialog","DIALOG_TITLE","TITLE","content_url","width","WIDTH","height","HEIGHT","buttons","btnSave","btnCancel","renderIntro","renderDocuments","insertAdjacentHTML","notification","Notification","Box","basket_confirm","BasketConfirm","Property","print","Print","editor","overrideEditor","overrideEditorAjax","restoreOriginDefault","start","storeOriginDefault","addCustomEvent","_originDefault","_BX","EntityEditor","_BX$UI$EntityEditor","getDefault","setTimeout","setDefault","createAjaxForm","editorValidate","editorCreateAjaxForm","EntityAsyncValidator","control","_activeControls","addResult","_userFieldManager","parentMethod","callbacks","call","overrideAjaxForm","_ajaxForm","ajaxForm","_BX3","_BX3$UI","ComponentAjax","doSubmit","ajaxFormDoSubmit","formData","_elementNode","ajax","prepareForm","_formData","filesCount","isPlainObject","resultData","makeFormData","runComponentAction","_className","_actionName","signedParameters","_signedParameters","getParameters","_getParameters","response","callback","prop","getFunction","_callbacks","onCustomEvent","catch","errors"],"mappings":"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"}