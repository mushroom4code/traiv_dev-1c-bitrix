<?if(!$USER->IsAdmin()) return;use \Bitrix\Main\Localization\Loc;IncludeModuleLangFile(__FILE__);if ( ! CModule::IncludeModule('twim.recaptchafree') )	return (false);//Restore defaultsif ($_SERVER["REQUEST_METHOD"]=="POST" && strlen($RestoreDefaults)>0 && check_bitrix_sessid()) {	COption::RemoveOption("twim.recaptchafree");}$arAllOptions =	Array("act", "key", "secretkey", "theme", "size", "badge", "mask_exclusion"); $aTabs = array();$arSitesParam = array();$sites_	= CSite::getList($by="sort", $order="asc", Array());while($site	= $sites_->fetch()){    $arSitesParam[] = $site;	    $aTabs[] = array('DIV' => 'twim_recaptchafree_site_settings_' . $site['LID'], 'TAB' => $site['NAME'] . ' (' . $site['LID'] . ')', 'ICON' => 'settings', 'TITLE' => Loc::getMessage('GCT_SETTINGS') . $site['NAME'] . ' (' . $site['LID'] . ')');} $aTabs[] = array(     "DIV" => "donate",     "TAB" => Loc::getMessage('GCT_DONATE_TAB'),     "ICON" => "main_user_edit",     "TITLE" => Loc::getMessage('GCT_DONATE_TAB_TITLE'), );	//Save optionsif($_SERVER["REQUEST_METHOD"]=="POST" ){		foreach($arSitesParam as $site){		$arSettings	= Array();		foreach($arAllOptions as $option){			if (isset($_POST[$option."_".$site['LID']])){				$arSettings[$option]	= $_POST[$option."_".$site['LID']];			}			}        //Debug::dump($arSettings); 		COption::SetOptionString("twim.recaptchafree", "settings", serialize($arSettings), false, $site['LID']);	}	}		$tabControl = new CAdminTabControl("tabControl", $aTabs);$tabControl->Begin();?><form name="twim_recaptchafree_settings" method="post" action="<?echo $APPLICATION->GetCurPage()?>?mid=<?=htmlspecialcharsbx($mid)?>&amp;lang=<?echo LANG?>">		<?foreach($arSitesParam as $site):?>			<?$tabControl->BeginNextTab();?>		<h4><?=Loc::getMessage("GCT_LINK_RECAPTCHA")?></h4>		<?$settings	= COption::GetOptionString("twim.recaptchafree", "settings", false, $site['LID']);		if(!$settings){			$arSettings	= array();		}else{				$arSettings	= unserialize($settings);		}	        if(empty($arSettings['mask_exclusion'])){ // default mask            $arSettings['mask_exclusion'] = '/404.php;/upload/*;/cgi-bin/*';        }?>		<tr>			<td><?=Loc::getMessage('GCT_ACT');?></td>			<td><input name="act_<?=$site['LID'];?>" type="checkbox" <?=$arSettings['act']=='Y'?'checked="true"':'';?> value="Y"/></td>		</tr>		<tr>			<td><?=Loc::getMessage('GCT_KEY');?></td>			<td><input name="key_<?=$site['LID'];?>" type="text" size="45" value="<?=$arSettings['key'];?>"/></td>		</tr>		<tr>			<td><?=Loc::getMessage('GCT_SECRETKEY');?></td>			<td><input name="secretkey_<?=$site['LID'];?>" type="text" size="45" value="<?=$arSettings['secretkey'];?>"/></td>		</tr>		<tr>			<td><?=Loc::getMessage('GCT_THEME');?></td>			<td>				<select name="theme_<?=$site['LID'];?>">					<option <?=$arSettings['theme']=='light'?'selected':'';?> value="light"><?=Loc::getMessage('GCT_THEME_LIGHT');?></option>					<option <?=$arSettings['theme']=='dark'?'selected':'';?> value="dark"><?=Loc::getMessage('GCT_THEME_DARK');?></option>				</select>			</td>		</tr>        <tr>			<td><?=Loc::getMessage('GCT_SIZE');?></td>			<td>				<select id="el_size_<?=$site['LID'];?>" name="size_<?=$site['LID'];?>">					<option <?=$arSettings['size']=='normal'?'selected':'';?> value="normal"><?=Loc::getMessage('GCT_SIZE_NORMAL');?></option>					<option <?=$arSettings['size']=='compact'?'selected':'';?> value="compact"><?=Loc::getMessage('GCT_SIZE_COMPACT');?></option>					<option <?=$arSettings['size']=='invisible'?'selected':'';?> value="invisible"><?=Loc::getMessage('GCT_SIZE_INVISIBLE');?></option>				</select>                <script type="text/javascript">                    document.getElementById("el_size_<?=$site['LID'];?>").onchange = function(e){                        var badge = document.getElementById("container_badge_<?=$site['LID'];?>");                         if(e.target.value === "invisible"){                            badge.style.display = "table-row";                        }else{                            badge.style.display = "none";                        }                    };                </script>			</td>		</tr>        <tr id="container_badge_<?=$site['LID'];?>" <?if($arSettings['size']!=='invisible'):?> style="display: none;"<?endif;?>>			<td><?=Loc::getMessage('GCT_BADGE');?></td>			<td>				<select name="badge_<?=$site['LID'];?>">					<option <?=$arSettings['badge']=='bottomright'?'selected':'';?> value="bottomright">bottomright</option>					<option <?=$arSettings['badge']=='bottomleft'?'selected':'';?> value="bottomleft">bottomleft</option>                    <option <?=$arSettings['badge']=='inline'?'selected':'';?> value="inline">inline</option>				</select>			</td>		</tr        <tr>			<td><?=Loc::getMessage('GCT_MASK_EXCLUSION');?></td>			<td>                <textarea name="mask_exclusion_<?=$site['LID'];?>" style="width:100%" ><?=$arSettings['mask_exclusion'];?></textarea>			</td>		</tr>		<?endforeach;?>    <?$tabControl->BeginNextTab();?>        <tr>        <td colspan="2" align="left">            <h3><?=Loc::getMessage('GCT_DONATE_SUPPORT_DEVELOPERS');?></h3>            <iframe src="https://money.yandex.ru/quickpay/shop-widget?writer=seller&targets=%D0%9D%D0%B0%20%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D1%8C%D0%BA%D0%B8%20%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D1%83%2C%20%D0%B4%D0%BB%D1%8F%20%D1%80%D0%B0%D0%B7%D0%B2%D0%B8%D1%82%D0%B8%D1%8F%20%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F&targets-hint=&default-sum=500&button-text=11&payment-type-choice=on&mobile-payment-type-choice=on&comment=on&hint=&successURL=&quickpay=shop&account=410013777062858" width="423" height="329" frameborder="0" allowtransparency="true" scrolling="no"></iframe>        </td>    </tr>    	<?$tabControl->Buttons(array());	$tabControl->End();	?></form>